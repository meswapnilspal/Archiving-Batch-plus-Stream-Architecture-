{"version":"NotebookV1","origId":2709619314154962,"name":"STD Master Notebook Stream_testcopy","language":"python","commands":[{"version":"CommandV1","origId":2709619314154963,"guid":"33c6f695-97e3-4d28-b312-c19c56be7d44","subtype":"command","commandType":"auto","position":2.0,"command":"#%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":2,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ef269548-28d1-42bf-87d3-68b8f74f4f83"},{"version":"CommandV1","origId":2709619314154964,"guid":"95b7bdd6-01fa-4f60-bede-89e6343538ac","subtype":"command","commandType":"auto","position":3.0,"command":"# SET LOAD TYPE (FULL LOAD = Yes/No)\ndbutils.widgets.text(\"FULL_LOAD\", \"No\", \"FULL LOAD\")\nFULL_LOAD = dbutils.widgets.get(\"FULL_LOAD\")\n\n# SET ENVIRONMENT FOR DATA LAKE (02 OR 10 OR etc)\ndbutils.widgets.text(\"env\", \"02\", \"ADLS ENVIRONMENT\")\nenv = dbutils.widgets.get(\"env\")\n\n#SET TABLE LIST (nonpii OR pii) \ndbutils.widgets.text(\"pii_or_nonpii\", \"nonpii\", \"TABLE PREFERENCE( NONPII/PII)\")\npii_or_nonpii = dbutils.widgets.get(\"pii_or_nonpii\")\n\n# SET MANUAL LIST OF TABLES (for example = table1 table2 table3 etc)\ndbutils.widgets.text(\"manual_list_str\", \"\", \"MANUAL TABLE LIST\")\nmanual_list_str = dbutils.widgets.get(\"manual_list_str\")\nmanual_list  =  (list(manual_list_str.split()))\n\n# print(manual_list_str)\n# print(manual_list)\n\n# SET DATABASE NAME\ndbutils.widgets.text(\"db_name\", \"cods_nonprod_active\", \"DATABASE NAME\")\ndb_name = dbutils.widgets.get(\"db_name\")\n\n#SET BASEPATH\nbasepath = 'abfss://dev@dtecuprodedaadl' + env + '.dfs.core.windows.net/'\n\n#SET SEGREGATED LOCATION PATH \ndbutils.widgets.text(\"replicate_loc\", \"curated/ISU_archive/cods_nonprod_compose\", \"REPLICATE-COMPOSE LOC\")\nreplicate_loc = basepath + dbutils.widgets.get(\"replicate_loc\")\n\n#SET STAGING LOCATION PATH\nstaging_location = replicate_loc\n\n#SET SILVER LOCATION PATH \ndbutils.widgets.text(\"silver_location\", \"curated/ISU_archive/silver\", \"SILVER LOC\")\nsilver_location = basepath + dbutils.widgets.get(\"silver_location\")\n\n#SET BRONZE LOCATION PATH \ndbutils.widgets.text(\"bronze_location\", \"curated/ISU_archive/bronze\", \"BRONZE LOC\")\nbronze_location = basepath + dbutils.widgets.get(\"bronze_location\")\n\n#SET EXECUTION LOGS LOCATION PATH \ndbutils.widgets.text(\"execution_logs_loc\", \"ISU_archive_support/execution_logs/stream_logs\", \"EXECUTION LOGS LOC\")\nexecution_logs_loc = basepath + dbutils.widgets.get(\"execution_logs_loc\")\n\n# SET RUN SINCE DATE (EXAMPLES : 2022-09-14, 2022-09-15, ...)\ndbutils.widgets.text(\"runsincedate\", \"\", \"RUN SINCE DATE\")\nrunsincedate = dbutils.widgets.get(\"runsincedate\")\n\n# SET METADATA FILEPATH FROM ADLS (For example  = ISU_archive_support/metadata/Final_metadata.csv)\ndbutils.widgets.text(\"metaadlspath\", \"ISU_archive_support/metadata/Final_metadata.csv\", \"METADATA FILE LOC\")\nmetaadlspath = dbutils.widgets.get(\"metaadlspath\")\n\n# SET METADATA FILE FULL PATH TO ADLS\nmetafilepath = basepath + metaadlspath\n\n#SET TABLE CREATION NOTEBOOK PATH\ndbutils.widgets.text(\"tablecreationnbpath\", \"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable\", \"TABLE CREATION NOTEBOOK PATH\")\ntablecreationnbpath = dbutils.widgets.get(\"tablecreationnbpath\")\n\n#SET DATA PEP NOTEBOOK PATH\ndbutils.widgets.text(\"dataprepnbpath\", \"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION\", \"DATA PREP NOTEBOOK PATH\")\ndataprepnbpath = dbutils.widgets.get(\"dataprepnbpath\")","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{"dataprepnbpath":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION","execution_logs_loc":"ISU_archive_support/execution_logs/stream_logs","tablecreationnbpath":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable","db_name":"cods_nonprod_active","pii_or_nonpii":"nonpii","replicate_loc":"curated/ISU_archive/cods_nonprod_compose","runsincedate":"","manual_list_str":"","silver_location":"curated/ISU_archive/silver","metaadlspath":"ISU_archive_support/metadata/Final_metadata.csv","FULL_LOAD":"No","bronze_location":"curated/ISU_archive/bronze","env":"02"},"addedWidgets":{"dataprepnbpath":{"widgetType":"text","name":"dataprepnbpath","defaultValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION","label":"DATA PREP NOTEBOOK PATH","options":{"widgetType":"text","validationRegex":null}},"execution_logs_loc":{"widgetType":"text","name":"execution_logs_loc","defaultValue":"ISU_archive_support/execution_logs/stream_logs","label":"EXECUTION LOGS LOC","options":{"widgetType":"text","validationRegex":null}},"tablecreationnbpath":{"widgetType":"text","name":"tablecreationnbpath","defaultValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable","label":"TABLE CREATION NOTEBOOK PATH","options":{"widgetType":"text","validationRegex":null}},"db_name":{"widgetType":"text","name":"db_name","defaultValue":"cods_nonprod_active","label":"DATABASE NAME","options":{"widgetType":"text","validationRegex":null}},"pii_or_nonpii":{"widgetType":"text","name":"pii_or_nonpii","defaultValue":"nonpii","label":"TABLE PREFERENCE( NONPII/PII)","options":{"widgetType":"text","validationRegex":null}},"replicate_loc":{"widgetType":"text","name":"replicate_loc","defaultValue":"curated/ISU_archive/cods_nonprod_compose","label":"REPLICATE-COMPOSE LOC","options":{"widgetType":"text","validationRegex":null}},"runsincedate":{"widgetType":"text","name":"runsincedate","defaultValue":"","label":"RUN SINCE DATE","options":{"widgetType":"text","validationRegex":null}},"manual_list_str":{"widgetType":"text","name":"manual_list_str","defaultValue":"","label":"MANUAL TABLE LIST","options":{"widgetType":"text","validationRegex":null}},"silver_location":{"widgetType":"text","name":"silver_location","defaultValue":"curated/ISU_archive/silver","label":"SILVER LOC","options":{"widgetType":"text","validationRegex":null}},"metaadlspath":{"widgetType":"text","name":"metaadlspath","defaultValue":"ISU_archive_support/metadata/Final_metadata.csv","label":"METADATA FILE LOC","options":{"widgetType":"text","validationRegex":null}},"FULL_LOAD":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"No","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}},"bronze_location":{"widgetType":"text","name":"bronze_location","defaultValue":"curated/ISU_archive/bronze","label":"BRONZE LOC","options":{"widgetType":"text","validationRegex":null}},"env":{"widgetType":"text","name":"env","defaultValue":"02","label":"ADLS ENVIRONMENT","options":{"widgetType":"text","validationRegex":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663681556365,"submitTime":1663681556330,"finishTime":1663681556397,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8d28ce0f-ad17-4d59-88fb-a2e9cdadc937"},{"version":"CommandV1","origId":2709619314154965,"guid":"ac0ecda9-8aed-4074-ad47-5699ee49727a","subtype":"command","commandType":"auto","position":4.0,"command":"print(\"basepath : \" + basepath)\nprint(\"FULL_LOAD : \" + FULL_LOAD)\nprint(\"pii_or_nonpii : \" + pii_or_nonpii)\nprint(\"manual_list : \" + manual_list_str)\nprint(\"db_name : \" + db_name)\nprint(\"replicate_loc : \" + replicate_loc)\nprint(\"staging_location : \" + staging_location)\nprint(\"silver_location : \" + silver_location)\nprint(\"bronze_location : \" + bronze_location)\nprint(\"execution_logs_loc : \" + execution_logs_loc)\nprint(\"metafilepath : \" + metafilepath)\nprint(\"tablecreationnbpath : \" + tablecreationnbpath)\nprint(\"dataprepnbpath : \" + dataprepnbpath)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"10db7f60-a40d-4080-bd2c-3b4ca9a531ac"},{"version":"CommandV1","origId":2709619314154966,"guid":"0660bee9-20c5-4cb0-872c-910263c515bc","subtype":"command","commandType":"auto","position":5.0,"command":"#START LOGGING #1\n\nimport logging\nimport datetime\n\nexecution_logs_loc2 = execution_logs_loc + \"/\"\n\n#ADD FOLDER IF NOT EXIST\ndbutils.fs.mkdirs(execution_logs_loc)\n\ncurrentutctime = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')\nfilenamewithtime = \"EDA_STREAM_\" + currentutctime +\".log\"\npartitions = datetime.datetime.now().strftime('%Y-%m-%d/')\n\ndbfslogbasepath = \"/tmp\" + \"/\" + filenamewithtime\n\n#TAG LOGGING INFO TO NOTEBOOK\nlogger = logging.getLogger('MasterNotebookStream')\n#SETTING THRESHOLD OF LOGGER TO INFO\nlogger.setLevel(logging.INFO)\nFilehandler = logging.FileHandler(dbfslogbasepath,mode = 'a')\nformatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s: %(message)s', datefmt='%m/%d/%Y %I:%M:%S %p')\nFilehandler.setFormatter(formatter)\nlogger.addHandler(Filehandler)\n\n#LOG INFO\nlogger.info(\"Master NoteBook for Stream run started \")\nlogger.info(\"Input Parameters >>\")\nlogger.info(\"basepath : \" + basepath + \",\" + \"FULL_LOAD : \" + FULL_LOAD + \",\" + \"pii_or_nonpii : \" + pii_or_nonpii + \",\" + \"manual_list : \" + manual_list_str + \",\" + \"db_name : \" + db_name + \",\" + \"replicate_loc : \" + replicate_loc + \",\" + \"staging_location : \" + staging_location + \",\" + \"silver_location : \" + silver_location + \",\" + \"bronze_location : \" + bronze_location + \",\" + \"metafilepath : \" + metafilepath + \",\" + \"tablecreationnbpath : \" + tablecreationnbpath + \",\" + \"dataprepnbpath : \" + dataprepnbpath)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9af70036-1551-47de-9a24-e9ac2b6499a3"},{"version":"CommandV1","origId":2709619314154967,"guid":"ca15333b-a090-4c3e-8b2a-7b6853df7c82","subtype":"command","commandType":"auto","position":6.0,"command":"#START LOGGING #2\n\nimport logging\nimport datetime\nn_execution_logs_loc2 = execution_logs_loc + \"_status\" + \"/\"\n#ADD FOLDER IF NOT EXIST\ndbutils.fs.mkdirs(n_execution_logs_loc2)\nn_filenamewithtime = \"EDA_STREAM_STATUS_\" + currentutctime +\".log\"\nn_dbfslogbasepath = \"/tmp\" + \"/\" + n_filenamewithtime","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2bb83df4-51a5-4449-9678-03dd51d285e6"},{"version":"CommandV1","origId":2709619314154968,"guid":"139900d8-a3a0-4b06-a539-da573e6c8a08","subtype":"command","commandType":"auto","position":7.0,"command":"print(replicate_loc)\nfileloc = dbutils.fs.ls(replicate_loc)\n\n# LIST OF TABLES FROM DIRECTORY \ntablelist1 = list(map(lambda p: p.name[:-1].upper(), fileloc))\n\n# LIST OF ALL NONPII TABLES\nnonpiitablelist = ['CDHDR','CDPOS','DBERCHV','DBERCHZ1','DBERCHZ2','DBERCHZ3','DBERDL','DBERDLB','DFKKKO','DFKKOPK','DFKKOPKC','DFKKOPKX','DFKKZK','DFKKZPE','DFKKZPT','DFKKZS','EABL','EABLG','EMDUSDRQHEAD','EMDUSDRQINPUT','EMDUSDRQITEM','EMDUSDRQRESULT','ERCHC','ERCHO','ERDB','ERDO','ETTIFB','ETTIFN']\n\n# LIST OF ALL PII TABLES\npiitablelist = ['BCONT','DFKKCOLL','DFKKCOLLH','DFKKLOCKS','DFKKLOCKSH','DFKKOP','DFKKOPCOLL','DFKKOPW','DFKKZP','DFKKZV','ERCH','ERDK','FKKMACTIVITIES','FKKMAKO','FKKMAKT','FKKMAZE']\n\nif(pii_or_nonpii == 'nonpii'):\n    tablelist2 = nonpiitablelist\n    print(tablelist2)\nelif(pii_or_nonpii == 'pii'):\n    tablelist2 = piitablelist\n    print(tablelist2)\n\n# EFFECTIVE TABLE LIST\ntablelist = [value for value in tablelist1 if value in tablelist2]","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c7ef6ed2-7d0b-41a6-bcd4-d53406b91b2e"},{"version":"CommandV1","origId":2709619314154969,"guid":"70c76f59-96bd-4fb0-8589-d768a55fe64b","subtype":"command","commandType":"auto","position":8.0,"command":"# IF TABLE LIST IS ENTERED MANUALLY FROM WIDGET THEN USE MANUAL TABLE LIST ELSE USE AVAILABLE TABLES LIST \n\nif(manual_list):\n    tablelist = manual_list\n    print(tablelist)\n    #LOG INFO\n    logger.info(\"Tablelist for current execution : \" + str(tablelist))\nelse:\n    tablelist\n    print(tablelist)\n    #LOG INFO\n    logger.info(\"Tablelist for current execution : \" + str(tablelist))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"69246252-4311-42b1-a184-4e8c79dc8f54"},{"version":"CommandV1","origId":2709619314154970,"guid":"2c914928-6bfd-4a69-a0f9-c760cd36ae3c","subtype":"command","commandType":"auto","position":9.0,"command":"# FOR ALL THE TABLES IN A LIST EXECUTE DATA PREPERATION FOLLOWED BY TABLE CREATION IN A LOOP\nlogger.info(\"----------------------------------------------------------------\")\n\ntry:  \n  for tablename in tablelist:\n      logger.info(\"Data Preperation Started for table : \" + tablename)\n      try:\n          dbutils.notebook.run(dataprepnbpath, 0, { \"FULL_LOAD\" : FULL_LOAD ,\"table_name\" : tablename , \"staging_location\" : staging_location , \"curated_location\" : bronze_location , \"silver_location\" : silver_location ,\"metafilepath\" : metafilepath , \"dbfslogbasepath\" : dbfslogbasepath , \"runsincedate\" : runsincedate , \"n_dbfslogbasepath\" : n_dbfslogbasepath  })\n          logger.info(\"Data Preperation Completed for table : \" + tablename)\n      except Exception as e:\n          logger.error(\"Error occurred while Executing Data Preparation : \"  + str(e))\n          logger.critical(\"Master NoteBook for Stream run Failed!\")\n          #dbutils.fs.mv(\"file:\" + dbfslogbasepath,execution_logs_loc2 + partitions + filenamewithtime)\n      \n#      logger.info(\"Table Creation Started for table : \" + tablename)\n#       try:\n#           dbutils.notebook.run(tablecreationnbpath, 0, { \"FULL_LOAD\" : FULL_LOAD , \"table_name\" : tablename , \"db_name\" : db_name , \"curated_location\" : silver_location ,\"metafilepath\" : metafilepath , \"dbfslogbasepath\" : dbfslogbasepath })\n#           logger.info(\"Table Creation Completed for table : \" + tablename)\n#           logger.info(\"----------------------------------------------------------------\")\n#       except Exception as e:        \n#           logger.error(\"Error occurred while Executing Table Creation : \" + str(e))\n#           logger.critical(\"Master NoteBook for Stream run Failed!\")\n#           #dbutils.fs.mv(\"file:\" + dbfslogbasepath,execution_logs_loc2 + partitions + filenamewithtime)    \n      print(\"DONE WITH TABLE : \" + tablename)\nexcept:\n  dbutils.fs.mv(\"file:\" + dbfslogbasepath,execution_logs_loc2 + partitions + filenamewithtime) \n  dbutils.fs.mv(\"file:\" + n_dbfslogbasepath,n_execution_logs_loc2 + partitions + n_filenamewithtime)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2d0d3e7a-a696-4f49-ac92-9e09f9830ac9"},{"version":"CommandV1","origId":2709619314154971,"guid":"51cb5486-1695-420f-9cc8-563ffe424695","subtype":"command","commandType":"auto","position":10.0,"command":"#LOG INFO\nlogger.info(\"Master NoteBook for Stream run Completed Successfully!\")\n\n#MOVE LOG FILE TO ADLS LOCATION\ndbutils.fs.mv(\"file:\" + dbfslogbasepath,execution_logs_loc2 + partitions + filenamewithtime)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a1f3ca0e-2f5d-42c3-ba3a-5f58a8d3e2d7"},{"version":"CommandV1","origId":2709619314154972,"guid":"26df7964-81b9-4282-96d8-49b931d77e09","subtype":"command","commandType":"auto","position":11.0,"command":"#MOVE STATUS LOG FILE TO ADLS LOCATION\ndbutils.fs.mv(\"file:\" + n_dbfslogbasepath,n_execution_logs_loc2 + partitions + n_filenamewithtime)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"83ad044f-6f3b-473b-a0c0-6804d70e68e8"}],"dashboards":[],"guid":"893e0a4f-935f-4018-bdf4-c7971da2ebf0","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"dataprepnbpath":{"nuid":"c9147af9-016d-4da3-bc2a-086990a23b65","currentValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION","widgetInfo":{"widgetType":"text","name":"dataprepnbpath","defaultValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION","label":"DATA PREP NOTEBOOK PATH","options":{"widgetType":"text","validationRegex":null}}},"execution_logs_loc":{"nuid":"4edc9add-d5da-4583-8056-c11918164749","currentValue":"ISU_archive_support/execution_logs/stream_logs","widgetInfo":{"widgetType":"text","name":"execution_logs_loc","defaultValue":"ISU_archive_support/execution_logs/stream_logs","label":"EXECUTION LOGS LOC","options":{"widgetType":"text","validationRegex":null}}},"tablecreationnbpath":{"nuid":"aa8b3783-4ca6-42b4-89fa-e95b57a529d3","currentValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable","widgetInfo":{"widgetType":"text","name":"tablecreationnbpath","defaultValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable","label":"TABLE CREATION NOTEBOOK PATH","options":{"widgetType":"text","validationRegex":null}}},"db_name":{"nuid":"62416efe-3bd7-4397-90ba-4bff774fc997","currentValue":"cods_nonprod_active","widgetInfo":{"widgetType":"text","name":"db_name","defaultValue":"cods_nonprod_active","label":"DATABASE NAME","options":{"widgetType":"text","validationRegex":null}}},"pii_or_nonpii":{"nuid":"e7e72b7a-c579-4ed7-a928-fbe9aa8b721d","currentValue":"nonpii","widgetInfo":{"widgetType":"text","name":"pii_or_nonpii","defaultValue":"nonpii","label":"TABLE PREFERENCE( NONPII/PII)","options":{"widgetType":"text","validationRegex":null}}},"replicate_loc":{"nuid":"1608c739-6ea9-486f-8085-2621bf3e20fd","currentValue":"curated/ISU_archive/cods_nonprod_compose","widgetInfo":{"widgetType":"text","name":"replicate_loc","defaultValue":"curated/ISU_archive/cods_nonprod_compose","label":"REPLICATE-COMPOSE LOC","options":{"widgetType":"text","validationRegex":null}}},"runsincedate":{"nuid":"5ed1ec56-c0e4-40f2-a36f-83e91fad7bbd","currentValue":"","widgetInfo":{"widgetType":"text","name":"runsincedate","defaultValue":"","label":"RUN SINCE DATE","options":{"widgetType":"text","validationRegex":null}}},"manual_list_str":{"nuid":"4bfa77bc-05d1-43e3-8c6b-1358b59d719e","currentValue":"","widgetInfo":{"widgetType":"text","name":"manual_list_str","defaultValue":"","label":"MANUAL TABLE LIST","options":{"widgetType":"text","validationRegex":null}}},"silver_location":{"nuid":"84b99efc-1b25-4191-b165-8b6832599858","currentValue":"curated/ISU_archive/silver","widgetInfo":{"widgetType":"text","name":"silver_location","defaultValue":"curated/ISU_archive/silver","label":"SILVER LOC","options":{"widgetType":"text","validationRegex":null}}},"metaadlspath":{"nuid":"ac927372-d470-43f9-bde7-f9dcdccb5298","currentValue":"ISU_archive_support/metadata/Final_metadata.csv","widgetInfo":{"widgetType":"text","name":"metaadlspath","defaultValue":"ISU_archive_support/metadata/Final_metadata.csv","label":"METADATA FILE LOC","options":{"widgetType":"text","validationRegex":null}}},"FULL_LOAD":{"nuid":"43e2f1df-54e2-48f5-9ed1-180b86006b69","currentValue":"No","widgetInfo":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"No","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}},"bronze_location":{"nuid":"f098b6a1-d9a1-463d-b42d-26e8d5f63e9b","currentValue":"curated/ISU_archive/bronze","widgetInfo":{"widgetType":"text","name":"bronze_location","defaultValue":"curated/ISU_archive/bronze","label":"BRONZE LOC","options":{"widgetType":"text","validationRegex":null}}},"env":{"nuid":"b146af8d-fb7c-4fd0-b22a-536a8fee92a1","currentValue":"02","widgetInfo":{"widgetType":"text","name":"env","defaultValue":"02","label":"ADLS ENVIRONMENT","options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}