{"version":"NotebookV1","origId":2709619314154457,"name":"STD Master Notebook Stream","language":"python","commands":[{"version":"CommandV1","origId":2709619314154458,"guid":"95c07609-9288-4461-8954-6a42650c5fec","subtype":"command","commandType":"auto","position":4.2978515625,"command":"%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":true,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"30898106-fcea-44bc-b75f-d38cf3b465f7"},{"version":"CommandV1","origId":2709619314154459,"guid":"1cdae0c0-3c25-4659-9343-34d84afc88f7","subtype":"command","commandType":"auto","position":8.595703125,"command":"# SET LOAD TYPE (FULL LOAD = Yes/No)\ndbutils.widgets.text(\"FULL_LOAD\", \"No\", \"FULL LOAD\")\nFULL_LOAD = dbutils.widgets.get(\"FULL_LOAD\")\n\n# SET ENVIRONMENT FOR DATA LAKE (02 OR 10 OR etc)\ndbutils.widgets.text(\"env\", \"\", \"ADLS ENVIRONMENT\")\nenv = dbutils.widgets.get(\"env\")\n\n#SET TABLE LIST (nonpii OR pii) \ndbutils.widgets.text(\"pii_or_nonpii\", \"\", \"TABLE LIST( NONPII/PII)\")\npii_or_nonpii = dbutils.widgets.get(\"pii_or_nonpii\")\n\n# SET MANUAL LIST OF TABLES ['table1','table2',etc]\ndbutils.widgets.text(\"manual_list\", \"\", \"MANUAL TABLE LIST\")\nmanual_list = dbutils.widgets.get(\"manual_list\")\n\n# SET DATABASE NAME\ndbutils.widgets.text(\"db_name\", \"cods_nonprod_active\", \"DATABASE NAME\")\ndb_name = dbutils.widgets.get(\"db_name\")\n\n#SET BASEPATH\nbasepath = 'abfss://dev@dtecuprodedaadl' + env + '.dfs.core.windows.net/'\n\n#SET SEGREGATED LOCATION PATH \ndbutils.widgets.text(\"replicate_loc\", \"curated/ISU_archive/cods_nonprod_compose\", \"REPLICATE-COMPOSE LOC\")\nreplicate_loc = basepath + dbutils.widgets.get(\"replicate_loc\")\n\n#SET STAGING LOCATION PATH\nstaging_location = replicate_loc\n\n#SET SILVER LOCATION PATH \ndbutils.widgets.text(\"silver_location\", \"curated/ISU_archive/silver\", \"SILVER LOC\")\nsilver_location = basepath + dbutils.widgets.get(\"silver_location\")\n\n#SET BRONZE LOCATION PATH \ndbutils.widgets.text(\"bronze_location\", \"curated/ISU_archive/bronze\", \"BRONZE LOC\")\nbronze_location = basepath + dbutils.widgets.get(\"bronze_location\")\n\n# SET METADATA FILEPATH FROM ADLS (For example  = ISU_archive_support/metadata/Final_metadata.csv)\ndbutils.widgets.text(\"metaadlspath\", \"ISU_archive_support/metadata/Final_metadata.csv\", \"METADATA FILE LOC\")\nmetaadlspath = dbutils.widgets.get(\"metaadlspath\")\n\n# SET METADATA FILE FULL PATH TO ADLS\nmetafilepath = basepath + metaadlspath\n\n#SET TABLE CREATION NOTEBOOK PATH\ndbutils.widgets.text(\"tablecreationnbpath\", \"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable\", \"TABLE CREATION NOTEBOOK PATH\")\ntablecreationnbpath = dbutils.widgets.get(\"tablecreationnbpath\")\n\n#SET DATA PEP NOTEBOOK PATH\ndbutils.widgets.text(\"dataprepnbpath\", \"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION\", \"DATA PREP NOTEBOOK PATH\")\ndataprepnbpath = dbutils.widgets.get(\"dataprepnbpath\")","commandVersion":97,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"256082a3-6170-45ff-bd4e-c338e4737796"},{"version":"CommandV1","origId":2709619314154460,"guid":"2ed6924b-d34f-4863-8d18-93be56a6a645","subtype":"command","commandType":"auto","position":9.0732421875,"command":"print(\"basepath : \" + basepath)\nprint(\"FULL_LOAD : \" + FULL_LOAD)\nprint(\"pii_or_nonpii : \" + pii_or_nonpii)\nprint(\"manual_list : \" + manual_list)\nprint(\"db_name : \" + db_name)\nprint(\"replicate_loc : \" + replicate_loc)\nprint(\"staging_location : \" + staging_location)\nprint(\"silver_location : \" + silver_location)\nprint(\"bronze_location : \" + bronze_location)\nprint(\"metafilepath : \" + metafilepath)\nprint(\"tablecreationnbpath : \" + tablecreationnbpath)\nprint(\"dataprepnbpath : \" + dataprepnbpath)","commandVersion":13,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2cba60cc-67de-42d9-99ae-77a875dc264a"},{"version":"CommandV1","origId":2709619314154461,"guid":"1d0e2e90-9bb5-49b7-a2e3-20657f8190b2","subtype":"command","commandType":"auto","position":11.0068359375,"command":"print(replicate_loc)\nfileloc = dbutils.fs.ls(replicate_loc)\n\n# LIST OF TABLES FROM DIRECTORY \ntablelist1 = list(map(lambda p: p.name[:-1].upper(), fileloc))\n\n# LIST OF ALL NONPII TABLES\nnonpiitablelist = ['CDHDR','CDPOS','DBERCHV','DBERCHZ1','DBERCHZ2','DBERCHZ3','DBERDL','DBERDLB','DFKKKO','DFKKOPK','DFKKOPKC','DFKKOPKX','DFKKZK','DFKKZPE','DFKKZPT','DFKKZS','EABL','EABLG','EMDUSDRQHEAD','EMDUSDRQINPUT','EMDUSDRQITEM','EMDUSDRQRESULT','ERCHC','ERCHO','ERDB','ERDO','ETTIFB','ETTIFN']\n\n# LIST OF ALL PII TABLES\npiitablelist = ['BCONT','DFKKCOLL','DFKKCOLLH','DFKKLOCKS','DFKKLOCKSH','DFKKOP','DFKKOPCOLL','DFKKOPW','DFKKZP','DFKKZV','ERCH','ERDK','FKKMACTIVITIES','FKKMAKO','FKKMAKT','FKKMAZE']\n\nif(pii_or_nonpii == 'nonpii'):\n    tablelist2 = nonpiitablelist\n    print(tablelist2)\nelif(pii_or_nonpii == 'pii'):\n    tablelist2 = piitablelist\n    print(tablelist2)\n\n# EFFECTIVE TABLE LIST\ntablelist = [value for value in tablelist1 if value in tablelist2]","commandVersion":101,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c213b52a-59bd-4c21-acb4-534f0f4fbe36"},{"version":"CommandV1","origId":2709619314154462,"guid":"1dce71e0-65fd-468f-9262-55a2f9c10fbf","subtype":"command","commandType":"auto","position":12.462890625,"command":"# IF TABLE LIST IS ENTERED MANUALLY FROM WIDGET THEN USE MANUAL TABLE LIST ELSE USE AVAILABLE TABLES LIST \n\nif(manual_list):\n    tablelist = manual_list\n    print(tablelist) \nelse:\n    tablelist\n    print(tablelist) \n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8a503587-29b3-44e8-96b7-3ece075ea6ea"},{"version":"CommandV1","origId":2709619314154463,"guid":"9b09d92f-68cd-43ee-a279-d734f5fc9575","subtype":"command","commandType":"auto","position":15.5,"command":"# FOR ALL THE TABLES IN A LIST EXECUTE DATA PREPERATION FOLLOWED BY TABLE CREATION IN A LOOP\n\nfor tablename in tablelist:\n    dbutils.notebook.run(dataprepnbpath, 0, { \"FULL_LOAD\" : FULL_LOAD ,\"table_name\" : tablename , \"staging_location\" : staging_location , \"curated_location\" : bronze_location , \"silver_location\" : silver_location ,\"metafilepath\" : metafilepath })\n    dbutils.notebook.run(tablecreationnbpath, 0, { \"FULL_LOAD\" : FULL_LOAD , \"table_name\" : tablename , \"db_name\" : db_name , \"curated_location\" : silver_location ,\"metafilepath\" : metafilepath })\n    print(\"DONE WITH TABLE : \" + tablename)","commandVersion":82,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[{"jobId":270823788882318},{"jobId":921162960964703},{"jobId":294547294263121},{"jobId":1043557397013218},{"jobId":241393565437697},{"jobId":551295245263724},{"jobId":308019394970052},{"jobId":438628030776752},{"jobId":1041410438431146},{"jobId":979073705329730}],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d3fd9f19-fb0f-4b3d-a997-feb167ccabe7"}],"dashboards":[],"guid":"42548b0d-9b0b-4996-a87a-51c999e4a6b7","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"manual_list":{"nuid":"f85c8190-43f5-4b2f-a850-2c81e9dc7634","currentValue":"","widgetInfo":{"widgetType":"text","name":"manual_list","defaultValue":"","label":"MANUAL TABLE LIST","options":{"widgetType":"text","validationRegex":null}}},"dataprepnbpath":{"nuid":"e9428ed0-7ca6-44c5-a7b5-2bdec38e2e79","currentValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION","widgetInfo":{"widgetType":"text","name":"dataprepnbpath","defaultValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD STREAM_DATA_PREPARATION","label":"DATA PREP NOTEBOOK PATH","options":{"widgetType":"text","validationRegex":null}}},"tablecreationnbpath":{"nuid":"d8725604-f87f-4347-943b-89f9259f61f9","currentValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable","widgetInfo":{"widgetType":"text","name":"tablecreationnbpath","defaultValue":"/EDA/Data Engineer/POD_7_Dev/Archiving/Std_Stream/STD Stream Dynamic Table Creation Using MetaTable","label":"TABLE CREATION NOTEBOOK PATH","options":{"widgetType":"text","validationRegex":null}}},"db_name":{"nuid":"350e01be-a42c-4c1a-b47e-143cdc668b99","currentValue":"cods_nonprod_active","widgetInfo":{"widgetType":"text","name":"db_name","defaultValue":"cods_nonprod_active","label":"DATABASE NAME","options":{"widgetType":"text","validationRegex":null}}},"replicate_loc":{"nuid":"56c2f754-eeee-460f-99c0-25a2ec7b0fa1","currentValue":"curated/ISU_archive/cods_nonprod_compose","widgetInfo":{"widgetType":"text","name":"replicate_loc","defaultValue":"curated/ISU_archive/cods_nonprod_compose","label":"REPLICATE-COMPOSE LOC","options":{"widgetType":"text","validationRegex":null}}},"silver_location":{"nuid":"f534e7ce-6f75-4ce7-9920-105ee0b43bb1","currentValue":"curated/ISU_archive/silver","widgetInfo":{"widgetType":"text","name":"silver_location","defaultValue":"curated/ISU_archive/silver","label":"SILVER LOC","options":{"widgetType":"text","validationRegex":null}}},"metaadlspath":{"nuid":"707d0623-e903-43ec-9303-e0c1b85b95cb","currentValue":"ISU_archive_support/metadata/Final_metadata.csv","widgetInfo":{"widgetType":"text","name":"metaadlspath","defaultValue":"ISU_archive_support/metadata/Final_metadata.csv","label":"METADATA FILE LOC","options":{"widgetType":"text","validationRegex":null}}},"FULL_LOAD":{"nuid":"b597e661-27b6-459b-b97d-73d811d29a04","currentValue":"Yes","widgetInfo":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"No","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}},"bronze_location":{"nuid":"c42ff4e5-4d32-4a35-be16-095ce596b22d","currentValue":"curated/ISU_archive/bronze","widgetInfo":{"widgetType":"text","name":"bronze_location","defaultValue":"curated/ISU_archive/bronze","label":"BRONZE LOC","options":{"widgetType":"text","validationRegex":null}}},"env":{"nuid":"3e52b505-c50f-42a4-8f87-d482053d6aa7","currentValue":"02","widgetInfo":{"widgetType":"text","name":"env","defaultValue":"","label":"ADLS ENVIRONMENT","options":{"widgetType":"text","validationRegex":null}}},"table_list":{"nuid":"7bd6e182-8145-4502-a399-914c872f1104","currentValue":"nonpii","widgetInfo":{"widgetType":"text","name":"table_list","defaultValue":"","label":"TABLE LIST( NONPII/PII)","options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}