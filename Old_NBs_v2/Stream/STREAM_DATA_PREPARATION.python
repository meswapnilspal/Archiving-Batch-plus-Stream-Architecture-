{"version":"NotebookV1","origId":2709619314156037,"name":"STREAM_DATA_PREPARATION","language":"python","commands":[{"version":"CommandV1","origId":2709619314156038,"guid":"296b48ec-9f9a-4c36-92a5-9e40a3250ef7","subtype":"command","commandType":"auto","position":0.5,"command":"%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"The execution of this command did not finish successfully","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424623786,"submitTime":1661424623786,"finishTime":1661424634443,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":true,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8dc39775-467e-4ad3-949a-6f348e18a81b"},{"version":"CommandV1","origId":2709619314156039,"guid":"4ea6a16a-9043-409d-a7b9-c7719aa905ac","subtype":"script","commandType":"auto","position":0.5588235294117647,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c76bc472-f9e1-4d28-8a1e-2907938e7a9d"},{"version":"CommandV1","origId":2709619314156040,"guid":"64531416-8d78-4584-b628-e7fce542719f","subtype":"script","commandType":"auto","position":0.6176470588235294,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":["curated_location","staging_location","silver_location","FULL_LOAD","table_name"],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424625486,"submitTime":0,"finishTime":1661424625508,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"408d3751-a8fe-4d10-863e-a612fd2c25cb"},{"version":"CommandV1","origId":2709619314156041,"guid":"4c4333ed-b640-45cc-aa26-efe477c927fb","subtype":"script","commandType":"auto","position":0.6764705882352942,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424625517,"submitTime":0,"finishTime":1661424625534,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"610f2271-c0b4-478e-9177-81b4fb820cdc"},{"version":"CommandV1","origId":2709619314156042,"guid":"3024774d-781e-4a13-87d6-085b5aa21b0f","subtype":"script","commandType":"auto","position":0.7352941176470589,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"3dec7dcd-02ab-4cf9-8307-98a0804e28cf"},{"version":"CommandV1","origId":2709619314156043,"guid":"ed5fed70-9925-4963-86bd-1589811df5fd","subtype":"script","commandType":"auto","position":0.7941176470588236,"command":"","commandVersion":1,"state":"finished","results":{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424625546,"submitTime":0,"finishTime":1661424625599,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c1eb0be3-4eb5-4b26-9e34-3cdd1c9416ae"},{"version":"CommandV1","origId":2709619314156044,"guid":"53595403-30b8-4743-8ded-fab6a944b2a9","subtype":"script","commandType":"auto","position":0.8529411764705883,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424625608,"submitTime":0,"finishTime":1661424625636,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7515cb8a-2390-433d-82f9-f08339428da9"},{"version":"CommandV1","origId":2709619314156045,"guid":"54db8d5b-fb60-446f-8afc-1cc7e87f78a7","subtype":"script","commandType":"auto","position":0.9117647058823529,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424625651,"submitTime":0,"finishTime":1661424632590,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7acbc3bf-56f6-453e-87c5-205bd5d7c3a9"},{"version":"CommandV1","origId":2709619314156046,"guid":"ce4b94b0-15f0-4271-b7d2-5f288df4e2f0","subtype":"script","commandType":"auto","position":0.9705882352941176,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424632601,"submitTime":0,"finishTime":1661424632730,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a76313e7-cc6d-4bd4-ab37-d2803b38013a"},{"version":"CommandV1","origId":2709619314156047,"guid":"1e0be380-4cdd-4057-84a2-734641e58468","subtype":"command","commandType":"auto","position":1.0,"command":"from pyspark.sql.functions import *\nfrom pyspark.sql.window import Window\nimport fnmatch","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424634100,"submitTime":1661424623885,"finishTime":1661424634122,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"00194698-ce7f-4d6c-886d-53df7f5c63e2"},{"version":"CommandV1","origId":2709619314156048,"guid":"e526286e-efa1-4541-9b6d-7750952cd9d6","subtype":"script","commandType":"auto","position":1.0294117647058822,"command":"","commandVersion":1,"state":"finished","results":{"type":"table","data":[["edadataengineer","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","https://[REDACTED].azuredatalakestore.net/","https://[REDACTED].dfs.core.windows.net/","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"secretscope","type":"\"string\"","metadata":"{}"},{"name":"dbserver","type":"\"string\"","metadata":"{}"},{"name":"dbname","type":"\"string\"","metadata":"{}"},{"name":"username","type":"\"string\"","metadata":"{}"},{"name":"pwd","type":"\"string\"","metadata":"{}"},{"name":"adlsbasepathgen1","type":"\"string\"","metadata":"{}"},{"name":"adlsbasepathgen2","type":"\"string\"","metadata":"{}"},{"name":"adlsgen1storageaccountname","type":"\"string\"","metadata":"{}"},{"name":"adlsgen2storageaccountname","type":"\"string\"","metadata":"{}"},{"name":"adlsclientid","type":"\"string\"","metadata":"{}"},{"name":"adlscredential","type":"\"string\"","metadata":"{}"},{"name":"adlstenantid","type":"\"string\"","metadata":"{}"},{"name":"adlsclientidwrite","type":"\"string\"","metadata":"{}"},{"name":"adlscredentialwrite","type":"\"string\"","metadata":"{}"},{"name":"cosmossqlprodendpoint","type":"\"string\"","metadata":"{}"},{"name":"cosmossqlprodkey","type":"\"string\"","metadata":"{}"},{"name":"cosmossqltestendpoint","type":"\"string\"","metadata":"{}"},{"name":"cosmossqltestkey","type":"\"string\"","metadata":"{}"},{"name":"dtecotestaminsconnection","type":"\"string\"","metadata":"{}"},{"name":"dtecotestaminssharedaccesskey","type":"\"string\"","metadata":"{}"},{"name":"dtecudevcorpappsfleettelematicsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecudevdoadmsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecudevdoaminslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecudevdofsmnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecuprodcorpappsfleettelematicsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecuproddoaminslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestcustomervirtualassistantnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestcorpappsfleettelematicsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestdoadmsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestdoaminslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestdofsmnsslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecofsmefosourceaccesskey","type":"\"string\"","metadata":"{}"},{"name":"imagestoragekey","type":"\"string\"","metadata":"{}"},{"name":"imagesservicebusconnectionstring","type":"\"string\"","metadata":"{}"},{"name":"qlikadlsclientid","type":"\"string\"","metadata":"{}"},{"name":"qlikadlscredential","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424632743,"submitTime":0,"finishTime":1661424632985,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",1]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f9642f7c-8f2f-4c94-ae2a-90b8853a20db"},{"version":"CommandV1","origId":2709619314156049,"guid":"6ae29f51-8634-4cdb-bdf2-c197893f3b1a","subtype":"script","commandType":"auto","position":1.0882352941176472,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ab037e98-0a1a-4d5d-9f80-f35377c2d64c"},{"version":"CommandV1","origId":2709619314156050,"guid":"7bde633f-3166-44bc-afe7-9cd24b112b5a","subtype":"script","commandType":"auto","position":1.1470588235294117,"command":"","commandVersion":1,"state":"finished","results":{"type":"table","data":[["edadataengineer","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","https://[REDACTED].azuredatalakestore.net/","https://[REDACTED].dfs.core.windows.net/","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"secretscope","type":"\"string\"","metadata":"{}"},{"name":"dbserver","type":"\"string\"","metadata":"{}"},{"name":"dbname","type":"\"string\"","metadata":"{}"},{"name":"username","type":"\"string\"","metadata":"{}"},{"name":"pwd","type":"\"string\"","metadata":"{}"},{"name":"adlsbasepathgen1","type":"\"string\"","metadata":"{}"},{"name":"adlsbasepathgen2","type":"\"string\"","metadata":"{}"},{"name":"adlsgen1storageaccountname","type":"\"string\"","metadata":"{}"},{"name":"adlsgen2storageaccountname","type":"\"string\"","metadata":"{}"},{"name":"adlsclientid","type":"\"string\"","metadata":"{}"},{"name":"adlscredential","type":"\"string\"","metadata":"{}"},{"name":"adlstenantid","type":"\"string\"","metadata":"{}"},{"name":"adlsclientidwrite","type":"\"string\"","metadata":"{}"},{"name":"adlscredentialwrite","type":"\"string\"","metadata":"{}"},{"name":"cosmossqlprodendpoint","type":"\"string\"","metadata":"{}"},{"name":"cosmossqlprodkey","type":"\"string\"","metadata":"{}"},{"name":"cosmossqltestendpoint","type":"\"string\"","metadata":"{}"},{"name":"cosmossqltestkey","type":"\"string\"","metadata":"{}"},{"name":"dtecotestaminsconnection","type":"\"string\"","metadata":"{}"},{"name":"dtecotestaminssharedaccesskey","type":"\"string\"","metadata":"{}"},{"name":"dtecudevcorpappsfleettelematicsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecudevdoadmsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecudevdoaminslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecudevdofsmnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecuprodcorpappsfleettelematicsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecuproddoaminslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestcustomervirtualassistantnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestcorpappsfleettelematicsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestdoadmsnslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestdoaminslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecutestdofsmnsslisten","type":"\"string\"","metadata":"{}"},{"name":"dtecofsmefosourceaccesskey","type":"\"string\"","metadata":"{}"},{"name":"imagestoragekey","type":"\"string\"","metadata":"{}"},{"name":"imagesservicebusconnectionstring","type":"\"string\"","metadata":"{}"},{"name":"qlikadlsclientid","type":"\"string\"","metadata":"{}"},{"name":"qlikadlscredential","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424632997,"submitTime":0,"finishTime":1661424633445,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",1]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a16ee1f2-423d-4b40-b5ec-530a2f1553e1"},{"version":"CommandV1","origId":2709619314156051,"guid":"fa9fb6de-0e8f-4834-830e-a5a338317197","subtype":"script","commandType":"auto","position":1.2058823529411766,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"062a7e7a-4ef8-4240-b425-cb4c4364a870"},{"version":"CommandV1","origId":2709619314156052,"guid":"69e80d86-3514-4bc8-a72c-350dbe9777ca","subtype":"script","commandType":"auto","position":1.2647058823529411,"command":"","commandVersion":1,"state":"finished","results":{"type":"table","data":[["[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","https://[REDACTED].azuredatalakestore.net/","https://[REDACTED].dfs.core.windows.net/","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]","[REDACTED]"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"col_0","type":"\"string\"","metadata":"{}"},{"name":"col_1","type":"\"string\"","metadata":"{}"},{"name":"col_2","type":"\"string\"","metadata":"{}"},{"name":"col_3","type":"\"string\"","metadata":"{}"},{"name":"col_4","type":"\"string\"","metadata":"{}"},{"name":"col_5","type":"\"string\"","metadata":"{}"},{"name":"col_6","type":"\"string\"","metadata":"{}"},{"name":"col_7","type":"\"string\"","metadata":"{}"},{"name":"col_8","type":"\"string\"","metadata":"{}"},{"name":"col_9","type":"\"string\"","metadata":"{}"},{"name":"col_10","type":"\"string\"","metadata":"{}"},{"name":"col_11","type":"\"string\"","metadata":"{}"},{"name":"col_12","type":"\"string\"","metadata":"{}"},{"name":"col_13","type":"\"string\"","metadata":"{}"},{"name":"col_14","type":"\"string\"","metadata":"{}"},{"name":"col_15","type":"\"string\"","metadata":"{}"},{"name":"col_16","type":"\"string\"","metadata":"{}"},{"name":"col_17","type":"\"string\"","metadata":"{}"},{"name":"col_18","type":"\"string\"","metadata":"{}"},{"name":"col_19","type":"\"string\"","metadata":"{}"},{"name":"col_20","type":"\"string\"","metadata":"{}"},{"name":"col_21","type":"\"string\"","metadata":"{}"},{"name":"col_22","type":"\"string\"","metadata":"{}"},{"name":"col_23","type":"\"string\"","metadata":"{}"},{"name":"col_24","type":"\"string\"","metadata":"{}"},{"name":"col_25","type":"\"string\"","metadata":"{}"},{"name":"col_26","type":"\"string\"","metadata":"{}"},{"name":"col_27","type":"\"string\"","metadata":"{}"},{"name":"col_28","type":"\"string\"","metadata":"{}"},{"name":"col_29","type":"\"string\"","metadata":"{}"},{"name":"col_30","type":"\"string\"","metadata":"{}"},{"name":"col_31","type":"\"string\"","metadata":"{}"},{"name":"col_32","type":"\"string\"","metadata":"{}"},{"name":"col_33","type":"\"string\"","metadata":"{}"},{"name":"col_34","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424633460,"submitTime":0,"finishTime":1661424633896,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",1]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"022c4015-c3c4-4d32-9615-feb025f59161"},{"version":"CommandV1","origId":2709619314156053,"guid":"f74293c6-a3fb-4ff3-b11f-efce917b6af9","subtype":"script","commandType":"auto","position":1.3235294117647058,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b34c4ab9-29dc-4f9f-9e05-a13cbf3cd726"},{"version":"CommandV1","origId":2709619314156054,"guid":"47db3624-8415-44ad-bbef-de5b4790fd15","subtype":"script","commandType":"auto","position":1.3823529411764706,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424633909,"submitTime":0,"finishTime":1661424633929,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5db8ed30-a618-4226-b742-90c474c075ce"},{"version":"CommandV1","origId":2709619314156055,"guid":"4d2799fc-c106-4f0d-8246-17dc9a4bef25","subtype":"script","commandType":"auto","position":1.4411764705882353,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424633943,"submitTime":0,"finishTime":1661424634090,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["296b48ec-9f9a-4c36-92a5-9e40a3250ef7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6f8438f1-e915-463c-8eb3-5ea987856b0b"},{"version":"CommandV1","origId":2709619314156056,"guid":"2140b94d-f9d7-45e8-9d37-a071d1720f79","subtype":"command","commandType":"auto","position":2.0,"command":"# Table Name\ndbutils.widgets.text(\"table_name\", \"\", \"table name\")\ntable_name = dbutils.widgets.get(\"table_name\")\n\n# Staging location ( source here )\ndbutils.widgets.text(\"staging_location\", \"\", \"staging location\")\nstaging_location = \"'\" + dbutils.widgets.get(\"staging_location\") + \"/\" + table_name.lower() + \"'\"\n\n# Curated location ( destination here )\ndbutils.widgets.text(\"curated_location\", \"\", \"curated location\")\ncurated_location = \"'\" + dbutils.widgets.get(\"curated_location\") + \"/\" + table_name + \"'\"\n\ndbutils.widgets.text(\"silver_location\", \"\", \"silver zone\")\nsilver_location = \"'\" + dbutils.widgets.get(\"silver_location\") + \"/\" + table_name + \"'\"\n\ndbutils.widgets.text(\"FULL_LOAD\", \"\", \"FULL LOAD\")\nFULL_LOAD = dbutils.widgets.get(\"FULL_LOAD\")","commandVersion":29,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{"curated_location":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/bronze","table_name":"ERDB","staging_location":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/replicate","silver_location":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/silver","FULL_LOAD":"Yes"},"addedWidgets":{"curated_location":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}},"table_name":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}},"staging_location":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}},"silver_location":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver zone","options":{"widgetType":"text","validationRegex":null}},"FULL_LOAD":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661437448126,"submitTime":1661437448041,"finishTime":1661437448157,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"44ac3d21-d0db-4b03-8935-427b16c4755b"},{"version":"CommandV1","origId":2709619314156057,"guid":"81d74132-2130-484e-88b2-d64e1187378f","subtype":"command","commandType":"auto","position":3.0,"command":"print(table_name)\nprint(staging_location)\nprint(curated_location)","commandVersion":2,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">ERDB\n&#39;abfss://dev@[REDACTED].dfs.core.windows.net/curated/ISU_archive/replicate/erdb&#39;\n&#39;abfss://dev@[REDACTED].dfs.core.windows.net/curated/ISU_archive/bronze/ERDB&#39;\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424634164,"submitTime":1661424623989,"finishTime":1661424634181,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",207]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"61367c5d-46a0-4bee-836c-9eb531e946cf"},{"version":"CommandV1","origId":2709619314156058,"guid":"0e53b0ad-c1b3-4cb2-97c7-68cd85b5d681","subtype":"command","commandType":"auto","position":3.5,"command":"if (str(FULL_LOAD) == 'Yes'):\n  bronze_loc_cp = \"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/bronze\" + \"/\" + table_name + \"_checkpoint\"\n  bronze_loc = \"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/bronze\" + \"/\" + table_name\n  silver_loc = \"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/silver\" + \"/\" + table_name\n  print(bronze_loc,bronze_loc_cp,silver_loc, sep='\\n')\n  dbutils.fs.rm(bronze_loc_cp, True)\n  dbutils.fs.rm(bronze_loc, True)\n  dbutils.fs.rm(silver_loc, True)","commandVersion":105,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">abfss://dev@[REDACTED].dfs.core.windows.net/curated/ISU_archive/bronze/ERDB\nabfss://dev@[REDACTED].dfs.core.windows.net/curated/ISU_archive/bronze/ERDB_checkpoint\nabfss://dev@[REDACTED].dfs.core.windows.net/curated/ISU_archive/silver/ERDB\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1661424634191,"submitTime":1661424623999,"finishTime":1661424734030,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",266]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"82e7957e-97a2-41b7-babb-1025c0e3814f"},{"version":"CommandV1","origId":2709619314156059,"guid":"7021b0aa-a119-4370-b1ac-3ca0fd0172e7","subtype":"command","commandType":"auto","position":4.0,"command":"s = \"newdf = spark.readStream.option('ignoreChanges', 'true').format('delta').load(\" + staging_location + \")\"\nexec(s)\n\n# s = \"newdf = spark.read.format('delta').load(\" + staging_location + \")\"\n# exec(s)\n\n","commandVersion":66,"state":"error","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"<span class=\"ansi-red-fg\">AnalysisException</span>: Table schema is not set.  Write data into it or use CREATE TABLE to set the schema.;","errorTraceType":"html","error":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">AnalysisException</span>                         Traceback (most recent call last)\n<span class=\"ansi-green-fg\">&lt;command-2148954500682022&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      1</span> s <span class=\"ansi-blue-fg\">=</span> <span class=\"ansi-blue-fg\">&#34;newdf = spark.readStream.option(&#39;ignoreChanges&#39;, &#39;true&#39;).format(&#39;delta&#39;).load(&#34;</span> <span class=\"ansi-blue-fg\">+</span> staging_location <span class=\"ansi-blue-fg\">+</span> <span class=\"ansi-blue-fg\">&#34;)&#34;</span>\n<span class=\"ansi-green-fg\">----&gt; 2</span><span class=\"ansi-red-fg\"> </span>exec<span class=\"ansi-blue-fg\">(</span>s<span class=\"ansi-blue-fg\">)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      3</span> \n<span class=\"ansi-green-intense-fg ansi-bold\">      4</span> <span class=\"ansi-red-fg\"># s = &#34;newdf = spark.read.format(&#39;delta&#39;).load(&#34; + staging_location + &#34;)&#34;</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      5</span> <span class=\"ansi-red-fg\"># exec(s)</span>\n\n<span class=\"ansi-green-fg\">&lt;string&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n\n<span class=\"ansi-green-fg\">/databricks/spark/python/pyspark/sql/streaming.py</span> in <span class=\"ansi-cyan-fg\">load</span><span class=\"ansi-blue-fg\">(self, path, format, schema, **options)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">    416</span>                 raise ValueError(&#34;If the path is provided for stream, it needs to be a &#34; +\n<span class=\"ansi-green-intense-fg ansi-bold\">    417</span>                                  &#34;non-empty string. List of paths are not supported.&#34;)\n<span class=\"ansi-green-fg\">--&gt; 418</span><span class=\"ansi-red-fg\">             </span><span class=\"ansi-green-fg\">return</span> self<span class=\"ansi-blue-fg\">.</span>_df<span class=\"ansi-blue-fg\">(</span>self<span class=\"ansi-blue-fg\">.</span>_jreader<span class=\"ansi-blue-fg\">.</span>load<span class=\"ansi-blue-fg\">(</span>path<span class=\"ansi-blue-fg\">)</span><span class=\"ansi-blue-fg\">)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">    419</span>         <span class=\"ansi-green-fg\">else</span><span class=\"ansi-blue-fg\">:</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">    420</span>             <span class=\"ansi-green-fg\">return</span> self<span class=\"ansi-blue-fg\">.</span>_df<span class=\"ansi-blue-fg\">(</span>self<span class=\"ansi-blue-fg\">.</span>_jreader<span class=\"ansi-blue-fg\">.</span>load<span class=\"ansi-blue-fg\">(</span><span class=\"ansi-blue-fg\">)</span><span class=\"ansi-blue-fg\">)</span>\n\n<span class=\"ansi-green-fg\">/databricks/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py</span> in <span class=\"ansi-cyan-fg\">__call__</span><span class=\"ansi-blue-fg\">(self, *args)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">   1303</span>         answer <span class=\"ansi-blue-fg\">=</span> self<span class=\"ansi-blue-fg\">.</span>gateway_client<span class=\"ansi-blue-fg\">.</span>send_command<span class=\"ansi-blue-fg\">(</span>command<span class=\"ansi-blue-fg\">)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">   1304</span>         return_value = get_return_value(\n<span class=\"ansi-green-fg\">-&gt; 1305</span><span class=\"ansi-red-fg\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansi-green-intense-fg ansi-bold\">   1306</span> \n<span class=\"ansi-green-intense-fg ansi-bold\">   1307</span>         <span class=\"ansi-green-fg\">for</span> temp_arg <span class=\"ansi-green-fg\">in</span> temp_args<span class=\"ansi-blue-fg\">:</span>\n\n<span class=\"ansi-green-fg\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansi-cyan-fg\">deco</span><span class=\"ansi-blue-fg\">(*a, **kw)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">    131</span>                 <span class=\"ansi-red-fg\"># Hide where the exception came from that shows a non-Pythonic</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">    132</span>                 <span class=\"ansi-red-fg\"># JVM exception message.</span>\n<span class=\"ansi-green-fg\">--&gt; 133</span><span class=\"ansi-red-fg\">                 </span>raise_from<span class=\"ansi-blue-fg\">(</span>converted<span class=\"ansi-blue-fg\">)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">    134</span>             <span class=\"ansi-green-fg\">else</span><span class=\"ansi-blue-fg\">:</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">    135</span>                 <span class=\"ansi-green-fg\">raise</span>\n\n<span class=\"ansi-green-fg\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansi-cyan-fg\">raise_from</span><span class=\"ansi-blue-fg\">(e)</span>\n\n<span class=\"ansi-red-fg\">AnalysisException</span>: Table schema is not set.  Write data into it or use CREATE TABLE to set the schema.;</div>","workflows":[],"startTime":1661424624030,"submitTime":1661424624030,"finishTime":1661424735184,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ae1eee82-e61c-4d12-83ba-642a96758866"},{"version":"CommandV1","origId":2709619314156060,"guid":"28f39dab-5f71-43d9-a2aa-a772955585a7","subtype":"command","commandType":"auto","position":4.5,"command":"%run ../OTL/Load_Metadata","commandVersion":8,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"The execution of this command did not finish successfully","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624064,"submitTime":1661424624064,"finishTime":1661424735244,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0a908e1b-5353-4cdd-af31-2ec4f2f6d82d"},{"version":"CommandV1","origId":2709619314156061,"guid":"0537687c-b0a6-4307-b837-c89e5c67d924","subtype":"script","commandType":"auto","position":4.75,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1661424735204,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["28f39dab-5f71-43d9-a2aa-a772955585a7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c72dfa99-5a5d-4e02-9824-1b5323724f9e"},{"version":"CommandV1","origId":2709619314156062,"guid":"62f23a6d-f356-4183-ab8d-57752a973c45","subtype":"command","commandType":"auto","position":4.75,"command":"metadf = load_metadata_df()","commandVersion":2,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624109,"submitTime":1661424624109,"finishTime":1661424735258,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ff2f49d1-8477-4b7b-a582-be1ac044093a"},{"version":"CommandV1","origId":2709619314156063,"guid":"5bdda557-9f90-41bd-b118-2fc1934e7d84","subtype":"script","commandType":"auto","position":5.0,"command":"","commandVersion":40,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1661424735220,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["28f39dab-5f71-43d9-a2aa-a772955585a7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b79b8f9b-d062-4fd3-b310-8342a785c7a0"},{"version":"CommandV1","origId":2709619314156064,"guid":"b0351322-a90e-44a8-8689-feb6610f08eb","subtype":"command","commandType":"auto","position":5.0,"command":"def generate_code_for_casting_columns_based_on_metadata(metadf,table_name,dfname,newdfname):\n  z = str(\"\")\n  cols = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[0]).collect()\n  col_types = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[1]).collect()\n  for i,j in zip(cols,col_types):\n    i = '\"' + i + '\"'\n    j = '\"' + j + '\"'\n    z = z + ('.withColumn(' + i + ',col(' + i + ').cast(' + j + '))')\n  return(newdfname + ' = ' + dfname + z)","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624141,"submitTime":1661424624141,"finishTime":1661424735278,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f9ca9c4e-1998-407f-bafb-2f83db370ba0"},{"version":"CommandV1","origId":2709619314156065,"guid":"4dc8faaa-e460-43a3-a61a-9b0ad17f4f99","subtype":"script","commandType":"auto","position":5.25,"command":"","commandVersion":104,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1661424735242,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["28f39dab-5f71-43d9-a2aa-a772955585a7"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"1beb3524-a0fc-41a8-b8e2-72722bf751f1"},{"version":"CommandV1","origId":2709619314156066,"guid":"a6e59599-8861-4c3e-b3cd-8d400b4909b8","subtype":"command","commandType":"auto","position":6.0,"command":"get_code = generate_code_for_casting_columns_based_on_metadata(metadf,table_name,'newdf','casted_df')\nexec(get_code)\nprint(get_code)","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624173,"submitTime":1661424624173,"finishTime":1661424735299,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6eb95d86-db80-4509-8fb2-e648565a12fe"},{"version":"CommandV1","origId":2709619314156067,"guid":"25e6e4b2-6947-40c2-a978-0a6f0f1e03ac","subtype":"command","commandType":"auto","position":7.0,"command":"def generate_code_for_creating_partition_column_based_on_type(metadf,table_name,dfname,newdfname):  \n  # get partition column from metatable\n  col1 = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Partition_Key\") == 'Y').rdd.map(lambda x : x[0]).collect()\n  #print(col1)\n  #print(col1[0])\n  col2 = metadf.select('Partition_Key_Encoding').where(col('Table_Name')==table_name).where(col('Partition_Key') == 'Y').rdd.map(lambda x : x[0]).collect()\n  #print(col2[0])\n  if col1:\n    column_for_partition_logic = col1[0]\n    partition_logic_encoding = int(col2[0])\n  else:\n    column_for_partition_logic = None\n    partition_logic_encoding = None\n  \n  # decide partitioning logic based on encoding, and create partition column \n\n  if partition_logic_encoding == 1:\n    Logic_1 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',expr('substring(\" + column_for_partition_logic + \",length(\" + column_for_partition_logic +\") - 2,length(\" + column_for_partition_logic + \"))'))\"\n    return(Logic_1)\n  elif partition_logic_encoding == 2:\n    Logic_2 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',substring('\" + column_for_partition_logic + \"',1,6))\"\n    return(Logic_2)\n  elif partition_logic_encoding == 3:\n    Logic_3 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',substring('\" + column_for_partition_logic + \"',1,4))\"\n    return(Logic_3)\n  else:\n    Logic_4 = newdfname + \" = \" + dfname\n    return(Logic_4)","commandVersion":16,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624203,"submitTime":1661424624203,"finishTime":1661424735317,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4348697f-c60e-484d-b334-38b77c49bb88"},{"version":"CommandV1","origId":2709619314156068,"guid":"669b2a73-078a-4e7d-b57c-8cd8d541b895","subtype":"command","commandType":"auto","position":8.0,"command":"get_code = generate_code_for_creating_partition_column_based_on_type(metadf,table_name,'casted_df','replicate_df')\nprint(get_code)\nexec(get_code)","commandVersion":8,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624235,"submitTime":1661424624235,"finishTime":1661424735335,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e7d1c16f-3c45-46a2-bf67-1baab44d8f41"},{"version":"CommandV1","origId":2709619314156069,"guid":"f0caffdf-7e97-4197-a4be-57959e431ef1","subtype":"command","commandType":"auto","position":8.25,"command":"replicate_flags_added = replicate_df.withColumn('EPOCH_FLAG',lit('CURRENT')).withColumn(\"EDA_Creation_date\",current_timestamp()).withColumn(\"BATCH_date\",current_date())","commandVersion":29,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624271,"submitTime":1661424624271,"finishTime":1661424735354,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8a524b30-b1f2-43d0-92c2-148c5129e64f"},{"version":"CommandV1","origId":2709619314156070,"guid":"6355e6d6-a583-45dc-947d-30455af8ff89","subtype":"command","commandType":"auto","position":8.375,"command":"write_df = replicate_flags_added.drop('hdr__created_batch','hdr__modified_batch','hdr__oper','hdr__ts')","commandVersion":27,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624304,"submitTime":1661424624304,"finishTime":1661424735373,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e62d51c3-048a-4d9f-bb0a-bd0b238f1036"},{"version":"CommandV1","origId":2709619314156071,"guid":"555bf93e-ab0d-4440-821f-27e77bc94dce","subtype":"command","commandType":"auto","position":9.0,"command":"curated_location1 = curated_location[1:-1]\nprint(curated_location1)\n\nsaveloc = f\"{curated_location1}\"\n# saveloc_cp = f\"{curated_location}_checkpoint\"\n\n#streamQuery = write_df.writeStream.trigger(once=True).format(\"delta\").partitionBy(\"partitioncol\").option(\"checkpointLocation\",f\"{saveloc}_checkpoint\").start(saveloc)\nstreamQuery = write_df.writeStream.trigger(once=True).format(\"delta\").partitionBy(\"BATCH_date\").option(\"checkpointLocation\",f\"{saveloc}_checkpoint\").start(saveloc)\nstreamQuery.awaitTermination()","commandVersion":35,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624333,"submitTime":1661424624333,"finishTime":1661424735392,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"425af22a-dba0-4fcc-b01e-9ada5c9fa421"},{"version":"CommandV1","origId":2709619314156072,"guid":"60c28712-2b9c-4f95-b7f0-7f5c617a83cd","subtype":"command","commandType":"auto","position":10.0,"command":"s = \"bronzedf_entire = spark.read.format('delta').load(\" + curated_location + \")\"\nexec(s)","commandVersion":9,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624365,"submitTime":1661424624365,"finishTime":1661424735411,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8bd366cb-b83f-4888-bce8-149a02e912b2"},{"version":"CommandV1","origId":2709619314156073,"guid":"7332fcb2-36d0-4238-9cf1-90a2f6dd54a9","subtype":"command","commandType":"auto","position":10.125,"command":"# display(bronzedf_entire)","commandVersion":6,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624442,"submitTime":1661424624442,"finishTime":1661424735431,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"2498","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6e059242-a219-4d9b-9c43-7b26fbc9a986"},{"version":"CommandV1","origId":2709619314156074,"guid":"e2ffe64d-d77d-4ffd-8123-b0d5a51a9843","subtype":"command","commandType":"auto","position":10.25,"command":"\nif (str(FULL_LOAD) == 'Yes'):\n  bronzedf = bronzedf_entire\nelse:\n  bronzedf = bronzedf_entire.where(col(\"BATCH_date\") == current_date())\n  \n\n# bronzedf = bronzedf_entire.where(col(\"BATCH_date\") == current_date())","commandVersion":54,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624474,"submitTime":1661424624474,"finishTime":1661424735450,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5ed7b34e-1b32-4448-aec5-9991fa21675d"},{"version":"CommandV1","origId":2709619314156075,"guid":"c93eafa9-5074-455b-8ecb-e4ec0f5faf48","subtype":"command","commandType":"auto","position":10.625,"command":"# print(bronzedf_entire.count())\n# print(bronzedf.count())","commandVersion":9,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624577,"submitTime":1661424624577,"finishTime":1661424735470,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9d695539-f9de-4ca9-a8dd-737a1fb47432"},{"version":"CommandV1","origId":2709619314156076,"guid":"92f1a3e6-efe7-414d-ae7c-ade0ad23c089","subtype":"command","commandType":"auto","position":11.0,"command":"# duplicate removal\n\ndef duplicates_removal(dups_df):\n  df = dups_df.drop_duplicates()\n  keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\n#   orderbycol = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\").isNull()).rdd.map(lambda x : x[0]).collect()\n  orderbycol = 'EDA_Creation_date'\n\n  windowspec = Window.partitionBy(keyfields).orderBy(orderbycol)\n  table_archive = df.withColumn(\"row_number\",row_number().over(windowspec)).select(\"*\").where(col(\"row_number\")==1)\n  #table_erroneous = df.withColumn(\"row_number\",row_number().over(windowspec)).select(\"*\").where(col(\"row_number\")>1)\n  return (table_archive)","commandVersion":10,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624609,"submitTime":1661424624609,"finishTime":1661424735489,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"1c5250fc-5a77-461c-bf2e-1978b9e2fec9"},{"version":"CommandV1","origId":2709619314156077,"guid":"12a4ee9e-8515-4ec9-befe-694df0b33dcd","subtype":"command","commandType":"auto","position":11.25,"command":"bronze_with_BATCH_date = duplicates_removal(bronzedf)","commandVersion":24,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624665,"submitTime":1661424624665,"finishTime":1661424735509,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"02416fb8-3e7f-45cc-a9f8-65ad062b86ff"},{"version":"CommandV1","origId":2709619314156078,"guid":"925d0870-53de-4a3e-b25c-180535bd0b63","subtype":"command","commandType":"auto","position":11.375,"command":"bronze_write_DF = bronze_with_BATCH_date.drop('BATCH_date','row_number')","commandVersion":14,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624699,"submitTime":1661424624699,"finishTime":1661424735528,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a61a5b60-9577-4b5c-b714-c3318fd550f5"},{"version":"CommandV1","origId":2709619314156079,"guid":"5eb682df-bc56-4f5c-a42d-de895b782d98","subtype":"command","commandType":"auto","position":11.75,"command":"from delta.tables import *\nfrom pyspark.sql.functions import *\n\nif_partitioned_table = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Partition_Key\") == 'Y').rdd.map(lambda x : x[0]).collect()\n\nif (str(FULL_LOAD) == 'Yes'):\n  if if_partitioned_table:\n    s = 'bronze_write_DF.write.format(\"delta\").mode(\"overwrite\").partitionBy(\"partitioncol\").save(' + silver_location + ')'\n    exec(s)\n  else:\n    s = 'bronze_write_DF.write.format(\"delta\").mode(\"overwrite\").save(' + silver_location + ')'\n    exec(s)\n    \nelse:\n  keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\n  cond = ''\n  exitindex = len(keyfields)-1\n  for i in keyfields:\n      if keyfields.index(i) == exitindex:\n          cond = cond + 'logs.' + i + ' = newDedupedLogs.' + i\n      else:\n          cond = cond + 'logs.' + i + ' = newDedupedLogs.' + i + ' AND '\n\n  cond = cond + ' AND logs.EDA_Creation_date < newDedupedLogs.EDA_Creation_date'\n  print(cond)\n\n\n  #deltaTable = DeltaTable.forPath(spark, curated_location)\n  s = \"deltaTable = DeltaTable.forPath(spark, \" + silver_location + \")\"\n  exec(s)\n  newDedupedLogs = bronze_write_DF\n\n  deltaTable.alias(\"logs\").merge(\n      newDedupedLogs.alias(\"newDedupedLogs\"),\n      cond) \\\n    .whenMatchedUpdateAll() \\\n    .whenNotMatchedInsertAll() \\\n    .execute()","commandVersion":41,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624746,"submitTime":1661424624746,"finishTime":1661424735548,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"32753719-d6c5-434e-91f4-bf2ae3e7ea4b"},{"version":"CommandV1","origId":2709619314156080,"guid":"dc334202-2481-4eea-b06a-3b133771016b","subtype":"command","commandType":"auto","position":12.0,"command":"\n\n# keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\n# cond = ''\n# exitindex = len(keyfields)-1\n# for i in keyfields:\n#     if keyfields.index(i) == exitindex:\n#         cond = cond + 'logs.' + i + ' = newDedupedLogs.' + i\n#     else:\n#         cond = cond + 'logs.' + i + ' = newDedupedLogs.' + i + ' AND '\n\n# cond = cond + ' AND logs.EDA_Creation_date < newDedupedLogs.EDA_Creation_date'\n# print(cond)\n\n\n# #deltaTable = DeltaTable.forPath(spark, curated_location)\n# s = \"deltaTable = DeltaTable.forPath(spark, \" + silver_location + \")\"\n# exec(s)\n# newDedupedLogs = bronze_write_DF\n\n# deltaTable.alias(\"logs\").merge(\n#     newDedupedLogs.alias(\"newDedupedLogs\"),\n#     cond) \\\n#   .whenMatchedUpdateAll() \\\n#   .whenNotMatchedInsertAll() \\\n#   .execute()","commandVersion":38,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624821,"submitTime":1661424624821,"finishTime":1661424735567,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"4702","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"da05fa7f-441b-4ff9-8c2b-dcadd86bde70"},{"version":"CommandV1","origId":2709619314156081,"guid":"105dce12-86ec-4042-9736-c71edfdfcf96","subtype":"command","commandType":"auto","position":17.0,"command":"# s = \"silverdf = spark.read.format('delta').load(\" + silver_location + \")\"\n# exec(s)\n\n# silverdf.count()","commandVersion":13,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":1661424624851,"submitTime":1661424624851,"finishTime":1661424735586,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ed62c58e-3701-46de-9b03-a4ec7f7d1a42"}],"dashboards":[],"guid":"470841c0-bbab-46f9-85bc-02f0258ae0b5","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"curated_location":{"nuid":"3814e204-ee20-4696-9337-ff89616cd3a1","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/bronze","widgetInfo":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}}},"table_name":{"nuid":"e604d7ea-9761-410f-aea4-bf7c18a704bd","currentValue":"ERDB","widgetInfo":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}}},"staging_location":{"nuid":"3193e479-c93e-4e1a-ae1c-fdb4477d91db","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/replicate","widgetInfo":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}}},"silver_location":{"nuid":"cb95a823-346b-4fc5-87ff-37711c862ba1","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/silver","widgetInfo":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver zone","options":{"widgetType":"text","validationRegex":null}}},"FULL_LOAD":{"nuid":"0d87261e-a357-44dd-bd00-816599c87d77","currentValue":"Yes","widgetInfo":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}