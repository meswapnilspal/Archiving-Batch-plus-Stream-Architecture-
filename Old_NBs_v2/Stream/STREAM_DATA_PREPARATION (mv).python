{"version":"NotebookV1","origId":2709619314156203,"name":"STREAM_DATA_PREPARATION (mv)","language":"python","commands":[{"version":"CommandV1","origId":2709619314156204,"guid":"46762681-7aa5-4e2e-90e5-9173108e108d","subtype":"command","commandType":"auto","position":0.5,"command":"%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"The execution of this command did not finish successfully","errorTraceType":"html","error":null,"workflows":[],"startTime":1660734883928,"submitTime":1660734883928,"finishTime":1660734914606,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":true,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8dc39775-467e-4ad3-949a-6f348e18a81b"},{"version":"CommandV1","origId":2709619314156205,"guid":"bd14e93b-a68f-4cf9-91b3-00e65465c4b1","subtype":"script","commandType":"auto","position":0.5588235294117647,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c76bc472-f9e1-4d28-8a1e-2907938e7a9d"},{"version":"CommandV1","origId":2709619314156206,"guid":"5afee624-f064-4fc0-a699-99f27b30b0e1","subtype":"script","commandType":"auto","position":0.6176470588235294,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":["curated_location","staging_location","silver_location","FULL_LOAD","table_name"],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1660734885835,"submitTime":0,"finishTime":1660734885897,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"408d3751-a8fe-4d10-863e-a612fd2c25cb"},{"version":"CommandV1","origId":2709619314156207,"guid":"3bc870d1-11fd-41f7-b527-3f0c81f5c84e","subtype":"script","commandType":"auto","position":0.6764705882352942,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1660734885944,"submitTime":0,"finishTime":1660734885965,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"610f2271-c0b4-478e-9177-81b4fb820cdc"},{"version":"CommandV1","origId":2709619314156208,"guid":"eb804881-0754-4353-814e-6dda2741a561","subtype":"script","commandType":"auto","position":0.7352941176470589,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"3dec7dcd-02ab-4cf9-8307-98a0804e28cf"},{"version":"CommandV1","origId":2709619314156209,"guid":"dec35219-618e-4fea-b330-d0b51122e1a5","subtype":"script","commandType":"auto","position":0.7941176470588236,"command":"","commandVersion":1,"state":"finished","results":{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1660734885985,"submitTime":0,"finishTime":1660734886173,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c1eb0be3-4eb5-4b26-9e34-3cdd1c9416ae"},{"version":"CommandV1","origId":2709619314156210,"guid":"6f5fec9a-83a9-45bb-8519-0231e9101c8a","subtype":"script","commandType":"auto","position":0.8529411764705883,"command":"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1660734886191,"submitTime":0,"finishTime":1660734886220,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7515cb8a-2390-433d-82f9-f08339428da9"},{"version":"CommandV1","origId":2709619314156211,"guid":"82908ede-a475-48da-9bf0-1b7db6f6f08a","subtype":"script","commandType":"auto","position":0.9117647058823529,"command":"","commandVersion":1,"state":"error","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660734914493,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7acbc3bf-56f6-453e-87c5-205bd5d7c3a9"},{"version":"CommandV1","origId":2709619314156212,"guid":"66652046-64c5-4c9d-80b1-5b53bdb76dc4","subtype":"script","commandType":"auto","position":0.9705882352941176,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660734914511,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a76313e7-cc6d-4bd4-ab37-d2803b38013a"},{"version":"CommandV1","origId":2709619314156213,"guid":"fe7a6612-ea79-4961-bd8e-e7fb3b839e27","subtype":"command","commandType":"auto","position":1.0,"command":"from pyspark.sql.functions import *\nfrom pyspark.sql.window import Window\nimport fnmatch","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1660734938629,"submitTime":1660734935116,"finishTime":1660734938672,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"00194698-ce7f-4d6c-886d-53df7f5c63e2"},{"version":"CommandV1","origId":2709619314156214,"guid":"a3bc0c62-8113-482d-89f5-9e06c3154f4e","subtype":"script","commandType":"auto","position":1.0294117647058822,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660734914529,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f9642f7c-8f2f-4c94-ae2a-90b8853a20db"},{"version":"CommandV1","origId":2709619314156215,"guid":"240e5629-378b-43eb-a0fb-5a166e9d727b","subtype":"script","commandType":"auto","position":1.0882352941176472,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ab037e98-0a1a-4d5d-9f80-f35377c2d64c"},{"version":"CommandV1","origId":2709619314156216,"guid":"d2b85ba2-1e3d-446a-bb82-961691fb92e7","subtype":"script","commandType":"auto","position":1.1470588235294117,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660734914546,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a16ee1f2-423d-4b40-b5ec-530a2f1553e1"},{"version":"CommandV1","origId":2709619314156217,"guid":"155dd551-e1e5-4822-9df5-c692ffc15b08","subtype":"script","commandType":"auto","position":1.2058823529411766,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"062a7e7a-4ef8-4240-b425-cb4c4364a870"},{"version":"CommandV1","origId":2709619314156218,"guid":"ac8d8650-3c92-4eaa-bd98-5587b14ab207","subtype":"script","commandType":"auto","position":1.2647058823529411,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660734914564,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"022c4015-c3c4-4d32-9615-feb025f59161"},{"version":"CommandV1","origId":2709619314156219,"guid":"a626a3f9-7fba-4a63-a708-1877ae70bab7","subtype":"script","commandType":"auto","position":1.3235294117647058,"command":"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b34c4ab9-29dc-4f9f-9e05-a13cbf3cd726"},{"version":"CommandV1","origId":2709619314156220,"guid":"8e29c36d-94a5-40b3-bd39-bdee204d9a51","subtype":"script","commandType":"auto","position":1.3823529411764706,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660734914584,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5db8ed30-a618-4226-b742-90c474c075ce"},{"version":"CommandV1","origId":2709619314156221,"guid":"c657be37-67e6-4122-8dd5-de784a3c22b3","subtype":"script","commandType":"auto","position":1.4411764705882353,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Command skipped","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660734914605,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":[],"yColumns":[],"pivotColumns":[],"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["46762681-7aa5-4e2e-90e5-9173108e108d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6f8438f1-e915-463c-8eb3-5ea987856b0b"},{"version":"CommandV1","origId":2709619314156222,"guid":"fdd4171d-1c5b-409d-8409-31b3f311ed79","subtype":"command","commandType":"auto","position":2.0,"command":"# Table Name\ndbutils.widgets.text(\"table_name\", \"\", \"table name\")\ntable_name = dbutils.widgets.get(\"table_name\")\n\n# Staging location ( source here )\ndbutils.widgets.text(\"staging_location\", \"\", \"staging location\")\nstaging_location = \"'\" + dbutils.widgets.get(\"staging_location\") + \"/\" + table_name.lower() + \"'\"\n\n# Curated location ( destination here )\ndbutils.widgets.text(\"curated_location\", \"\", \"curated location\")\ncurated_location = \"'\" + dbutils.widgets.get(\"curated_location\") + \"/\" + table_name + \"'\"\n\ndbutils.widgets.text(\"silver_location\", \"\", \"silver zone\")\nsilver_location = \"'\" + dbutils.widgets.get(\"silver_location\") + \"/\" + table_name + \"'\"\n\ndbutils.widgets.text(\"FULL_LOAD\", \"\", \"FULL LOAD\")\nFULL_LOAD = dbutils.widgets.get(\"FULL_LOAD\")","commandVersion":29,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{"curated_location":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/bronze","table_name":"CDPOS","staging_location":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/replicate","silver_location":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/silver","FULL_LOAD":"Yes"},"addedWidgets":{"curated_location":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}},"table_name":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}},"staging_location":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}},"silver_location":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver zone","options":{"widgetType":"text","validationRegex":null}},"FULL_LOAD":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1660734950821,"submitTime":1660734950750,"finishTime":1660734950849,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"44ac3d21-d0db-4b03-8935-427b16c4755b"},{"version":"CommandV1","origId":2709619314156223,"guid":"9df24c76-5338-4997-81f8-31c43650df2a","subtype":"command","commandType":"auto","position":3.0,"command":"print(table_name)\nprint(staging_location)\nprint(curated_location)","commandVersion":2,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">CDPOS\n&#39;abfss://dev@[REDACTED].dfs.core.windows.net/curated/ISU_archive/replicate/cdpos&#39;\n&#39;abfss://dev@[REDACTED].dfs.core.windows.net/curated/ISU_archive/bronze/CDPOS&#39;\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1660734967085,"submitTime":1660734967013,"finishTime":1660734967106,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",210]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"61367c5d-46a0-4bee-836c-9eb531e946cf"},{"version":"CommandV1","origId":2709619314156224,"guid":"ddfb0289-33be-4ca9-8737-ea445c7128fc","subtype":"command","commandType":"auto","position":3.5,"command":"# staging_location = 'abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/replicate/dberchz3'","commandVersion":8,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470478,"submitTime":1660730470478,"finishTime":1660730475427,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"82e7957e-97a2-41b7-babb-1025c0e3814f"},{"version":"CommandV1","origId":2709619314156225,"guid":"28b936a3-ac99-443f-802b-6cac9a9c876b","subtype":"command","commandType":"auto","position":4.0,"command":"s = \"newdf = spark.readStream.option('ignoreChanges', 'true').format('delta').load(\" + staging_location + \")\"\nexec(s)\n\n# newdf = spark.readStream.option('inferSchema','True').format('delta').load(staging_location)\n","commandVersion":57,"state":"error","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660736128473,"submitTime":1660736128473,"finishTime":1660736213086,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ae1eee82-e61c-4d12-83ba-642a96758866"},{"version":"CommandV1","origId":2709619314156226,"guid":"680558ee-dcec-41aa-9976-18dc810181d9","subtype":"command","commandType":"auto","position":4.5,"command":"%run ../OTL/Load_Metadata","commandVersion":8,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"The execution of this command did not finish successfully","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470624,"submitTime":1660730470624,"finishTime":1660730475510,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0a908e1b-5353-4cdd-af31-2ec4f2f6d82d"},{"version":"CommandV1","origId":2709619314156227,"guid":"4ee266da-a1aa-40a7-829f-8f89e7d623d2","subtype":"command","commandType":"auto","position":4.75,"command":"metadf = load_metadata_df()","commandVersion":2,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470670,"submitTime":1660730470670,"finishTime":1660730475528,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ff2f49d1-8477-4b7b-a582-be1ac044093a"},{"version":"CommandV1","origId":2709619314156228,"guid":"914fa2fe-b578-4f51-9e34-3d41f7824352","subtype":"script","commandType":"auto","position":4.75,"command":"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660730475470,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["680558ee-dcec-41aa-9976-18dc810181d9"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c72dfa99-5a5d-4e02-9824-1b5323724f9e"},{"version":"CommandV1","origId":2709619314156229,"guid":"2d3ab6e2-2284-45e2-8776-e3f48b920cb7","subtype":"command","commandType":"auto","position":4.875,"command":"","commandVersion":0,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9420152f-bf82-43e6-ab91-5f08b1236581"},{"version":"CommandV1","origId":2709619314156230,"guid":"271594e1-f748-4d84-b516-3dbd4e409b45","subtype":"command","commandType":"auto","position":5.0,"command":"def generate_code_for_casting_columns_based_on_metadata(metadf,table_name,dfname,newdfname):\n  z = str(\"\")\n  cols = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[0]).collect()\n  col_types = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[1]).collect()\n  for i,j in zip(cols,col_types):\n    i = '\"' + i + '\"'\n    j = '\"' + j + '\"'\n    z = z + ('.withColumn(' + i + ',col(' + i + ').cast(' + j + '))')\n  return(newdfname + ' = ' + dfname + z)","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470738,"submitTime":1660730470738,"finishTime":1660730475549,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f9ca9c4e-1998-407f-bafb-2f83db370ba0"},{"version":"CommandV1","origId":2709619314156231,"guid":"4f510923-125f-4d6a-9ed5-5a923fa59050","subtype":"script","commandType":"auto","position":5.0,"command":"","commandVersion":40,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660730475487,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["680558ee-dcec-41aa-9976-18dc810181d9"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b79b8f9b-d062-4fd3-b310-8342a785c7a0"},{"version":"CommandV1","origId":2709619314156232,"guid":"1bed462c-19d6-482e-9a5a-a26c3877ab44","subtype":"script","commandType":"auto","position":5.25,"command":"","commandVersion":104,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":1660730475507,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["680558ee-dcec-41aa-9976-18dc810181d9"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"1beb3524-a0fc-41a8-b8e2-72722bf751f1"},{"version":"CommandV1","origId":2709619314156233,"guid":"5a21e97d-9ef7-4657-a33c-01fbdb1a8bf3","subtype":"command","commandType":"auto","position":6.0,"command":"get_code = generate_code_for_casting_columns_based_on_metadata(metadf,table_name,'newdf','casted_df')\nexec(get_code)\nprint(get_code)","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470774,"submitTime":1660730470774,"finishTime":1660730475569,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6eb95d86-db80-4509-8fb2-e648565a12fe"},{"version":"CommandV1","origId":2709619314156234,"guid":"1dd5a9d0-e54a-4715-b313-85fe1a192688","subtype":"command","commandType":"auto","position":7.0,"command":"def generate_code_for_creating_partition_column_based_on_type(metadf,table_name,dfname,newdfname):  \n  # get partition column from metatable\n  col1 = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Partition_Key\") == 'Y').rdd.map(lambda x : x[0]).collect()\n  #print(col1[0])\n  col2 = metadf.select('Partition_Key_Encoding').where(col('Table_Name')==table_name).where(col('Partition_Key') == 'Y').rdd.map(lambda x : x[0]).collect()\n  #print(col2[0])\n  column_for_partition_logic = col1[0]\n  partition_logic_encoding = int(col2[0])\n  \n  # decide partitioning logic based on encoding, and create partition column\n  Logic_1 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',expr('substring(\" + column_for_partition_logic + \",length(\" + column_for_partition_logic +\") - 2,length(\" + column_for_partition_logic + \"))'))\"\n  #print(Logic_1)\n  Logic_2 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',substring('\" + column_for_partition_logic + \"',1,6))\"\n  #print(Logic_2)\n  Logic_3 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',substring('\" + column_for_partition_logic + \"',1,4))\"\n\n  if partition_logic_encoding == 1:\n    return(Logic_1)\n  elif partition_logic_encoding == 2:\n    return(Logic_2)\n  elif partition_logic_encoding == 3:\n    return(Logic_3)\n  else:\n    return(\"print('no partition')\")","commandVersion":9,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470807,"submitTime":1660730470807,"finishTime":1660730475589,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4348697f-c60e-484d-b334-38b77c49bb88"},{"version":"CommandV1","origId":2709619314156235,"guid":"84de9ee6-ad54-4ea4-a8a5-6b646fb55cca","subtype":"command","commandType":"auto","position":8.0,"command":"get_code = generate_code_for_creating_partition_column_based_on_type(metadf,table_name,'casted_df','replicate_df')\nprint(get_code)\nexec(get_code)","commandVersion":8,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470845,"submitTime":1660730470845,"finishTime":1660730475615,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e7d1c16f-3c45-46a2-bf67-1baab44d8f41"},{"version":"CommandV1","origId":2709619314156236,"guid":"d2940cec-fcba-4557-b77c-a19b17e03714","subtype":"command","commandType":"auto","position":8.25,"command":"replicate_flags_added = replicate_df.withColumn('EPOCH_FLAG',lit('CURRENT')).withColumn(\"EDA_Creation_date\",current_timestamp())","commandVersion":25,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470880,"submitTime":1660730470880,"finishTime":1660730475638,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8a524b30-b1f2-43d0-92c2-148c5129e64f"},{"version":"CommandV1","origId":2709619314156237,"guid":"09bdd9cf-c5d7-403b-b361-dcd0afc70989","subtype":"command","commandType":"auto","position":8.375,"command":"write_df = replicate_flags_added.drop('hdr__created_batch','hdr__modified_batch','hdr__oper','hdr__ts')","commandVersion":27,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470951,"submitTime":1660730470951,"finishTime":1660730475661,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e62d51c3-048a-4d9f-bb0a-bd0b238f1036"},{"version":"CommandV1","origId":2709619314156238,"guid":"c6cc083a-6ba3-446c-9bf5-ac1bd8494b4b","subtype":"command","commandType":"auto","position":9.0,"command":"curated_location1 = curated_location[1:-1]\nprint(curated_location1)\n\nsaveloc = f\"{curated_location1}\"\n# saveloc_cp = f\"{curated_location}_checkpoint\"\n\nstreamQuery = write_df.writeStream.trigger(once=True).format(\"delta\").partitionBy(\"partitioncol\").option(\"checkpointLocation\",f\"{saveloc}_checkpoint\").start(saveloc)\nstreamQuery.awaitTermination()","commandVersion":29,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730470988,"submitTime":1660730470988,"finishTime":1660730475681,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"425af22a-dba0-4fcc-b01e-9ada5c9fa421"},{"version":"CommandV1","origId":2709619314156239,"guid":"781f56bc-262f-4271-9aa4-5748568dea1e","subtype":"command","commandType":"auto","position":10.0,"command":"s = \"bronzedf = spark.read.format('delta').load(\" + curated_location + \")\"\nexec(s)","commandVersion":7,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730471020,"submitTime":1660730471020,"finishTime":1660730475702,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8bd366cb-b83f-4888-bce8-149a02e912b2"},{"version":"CommandV1","origId":2709619314156240,"guid":"2cc8a99e-a7c6-442e-84fd-d8b135d5ee0c","subtype":"command","commandType":"auto","position":10.5,"command":"print(bronzedf.count())","commandVersion":6,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730471053,"submitTime":1660730471053,"finishTime":1660730475725,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"859ff3a3-9224-484e-a1cf-6df0a655ea02"},{"version":"CommandV1","origId":2709619314156241,"guid":"3f4224d3-f0de-4d75-b00d-d8c75c73c262","subtype":"command","commandType":"auto","position":11.5,"command":"if (str(FULL_LOAD) == 'Yes'):\n  s = 'bronzedf.limit(1).write.format(\"delta\").mode(\"overwrite\").save(' + silver_location + ')'\n  exec(s)","commandVersion":27,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730471088,"submitTime":1660730471088,"finishTime":1660730475745,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"aec7068f-b920-48f9-849f-25d6ab27cc42"},{"version":"CommandV1","origId":2709619314156242,"guid":"7d531158-7f3f-4b2a-acc2-2e9c17e14c30","subtype":"command","commandType":"auto","position":12.0,"command":"from delta.tables import *\nfrom pyspark.sql.functions import *\n\nkeyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\ncond = ''\nexitindex = len(keyfields)-1\nfor i in keyfields:\n    if keyfields.index(i) == exitindex:\n        cond = cond + 'logs.' + i + ' = newDedupedLogs.' + i\n    else:\n        cond = cond + 'logs.' + i + ' = newDedupedLogs.' + i + ' AND '\n\ncond = cond + ' AND logs.EDA_Creation_date < newDedupedLogs.EDA_Creation_date'\n# print(cond)\n\n\n#deltaTable = DeltaTable.forPath(spark, curated_location)\ns = \"deltaTable = DeltaTable.forPath(spark, \" + silver_location + \")\"\nexec(s)\nnewDedupedLogs = bronzedf\n\ndeltaTable.alias(\"logs\").merge(\n    newDedupedLogs.alias(\"newDedupedLogs\"),\n    cond) \\\n  .whenMatchedUpdateAll() \\\n  .whenNotMatchedInsertAll() \\\n  .execute()","commandVersion":32,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730471123,"submitTime":1660730471123,"finishTime":1660730475766,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"4702","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"da05fa7f-441b-4ff9-8c2b-dcadd86bde70"},{"version":"CommandV1","origId":2709619314156243,"guid":"6a1f46ca-ae28-448a-86e3-ebee56ca3519","subtype":"command","commandType":"auto","position":17.0,"command":"s = \"silverdf = spark.read.format('delta').load(\" + silver_location + \")\"\nexec(s)\n\nsilverdf.count()","commandVersion":12,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Cancelled","errorTraceType":"html","error":null,"workflows":[],"startTime":1660730471158,"submitTime":1660730471158,"finishTime":1660730475787,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ed62c58e-3701-46de-9b03-a4ec7f7d1a42"}],"dashboards":[],"guid":"622aa14f-94dc-4022-8de3-d7d7f75580e2","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"curated_location":{"nuid":"3814e204-ee20-4696-9337-ff89616cd3a1","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/bronze","widgetInfo":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}}},"table_name":{"nuid":"e604d7ea-9761-410f-aea4-bf7c18a704bd","currentValue":"CDPOS","widgetInfo":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}}},"staging_location":{"nuid":"3193e479-c93e-4e1a-ae1c-fdb4477d91db","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/replicate","widgetInfo":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}}},"silver_location":{"nuid":"cb95a823-346b-4fc5-87ff-37711c862ba1","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/curated/ISU_archive/silver","widgetInfo":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver zone","options":{"widgetType":"text","validationRegex":null}}},"FULL_LOAD":{"nuid":"0d87261e-a357-44dd-bd00-816599c87d77","currentValue":"Yes","widgetInfo":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}