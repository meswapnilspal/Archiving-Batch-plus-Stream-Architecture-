{"version":"NotebookV1","origId":2709619314155048,"name":"STD Statistics for Data load","language":"python","commands":[{"version":"CommandV1","origId":2709619314155049,"guid":"6cb37306-6761-42df-beca-b3bd07813585","subtype":"command","commandType":"auto","position":2.0,"command":"#%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":2,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"374cb99d-b90a-497e-92c0-5aa95e67d425"},{"version":"CommandV1","origId":2709619314155050,"guid":"04af352f-ab1a-4d6f-b63a-52d4e70bf03e","subtype":"command","commandType":"auto","position":3.0,"command":"# SET ENVIRONMENT FOR DATA LAKE (02 OR 10 OR etc)\ndbutils.widgets.text(\"env\", \"02\", \"ADLS ENVIRONMENT\")\nenv = dbutils.widgets.get(\"env\")\n\n#SET BASEPATH\nbasepath = 'abfss://dev@dtecuprodedaadl' + env + '.dfs.core.windows.net/'\n\n#SET SEGREGATED LOCATION PATH \ndbutils.widgets.text(\"segregated_loc\", \"raw/ISU_archive/segregated\", \"SEGREGATED LOC\")\nsegregated_loc = basepath + dbutils.widgets.get(\"segregated_loc\")\n\n#SET TARGET LOCATION PATH FOR LOGGING STATISTICS EXCELS\ndbutils.widgets.text(\"statistics_loc\", \"ISU_archive_support/statistics\", \"STATISTICS LOC\")\nstatistics_loc = basepath + dbutils.widgets.get(\"statistics_loc\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"33a2c0df-d1d3-4e21-8e39-1808d0c02344"},{"version":"CommandV1","origId":2709619314155051,"guid":"451d6be5-8fea-4804-ad1a-f545cc000d02","subtype":"command","commandType":"auto","position":4.0,"command":"print(\"basepath : \" + basepath)\nprint(\"segregated_loc : \" + segregated_loc)\nprint(\"statistics_loc : \" + statistics_loc)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"3b126ce9-17a7-4073-a081-9bb7f4ee51b3"},{"version":"CommandV1","origId":2709619314155052,"guid":"28d71907-7efe-4b1c-badb-858a6444850c","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n\n# Row Count per File","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7fba5f17-9fab-4d32-99c3-ef4df5442c3e"},{"version":"CommandV1","origId":2709619314155053,"guid":"d8dda08a-4186-497d-9ea1-70765dd0ba40","subtype":"command","commandType":"auto","position":6.0,"command":"from pyspark.sql import functions as F\nfrom pyspark.sql.functions import split\nfrom pyspark.sql.functions import *\n\ndf_csv = spark.read.csv(segregated_loc + \"/*\") \\\n    .withColumn(\"FilePath\", F.input_file_name()) \\\n    .groupby(\"FilePath\") \\\n    .agg(F.count(\"*\").alias(\"Row_Count_per_file\"))","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d8d48f1c-25d3-4948-b05b-fc8c0b9fbdeb"},{"version":"CommandV1","origId":2709619314155054,"guid":"591de6e0-cece-4518-9579-b4ed4f53ef71","subtype":"command","commandType":"auto","position":7.0,"command":"\ndf = df_csv.withColumn(\"FileNameRaw\", split((\"FilePath\"), \"/\").getItem(7))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"064b7c33-34de-4ce0-ac2c-2fd975218236"},{"version":"CommandV1","origId":2709619314155055,"guid":"9550784f-86ba-4200-9753-3328a2ff8857","subtype":"command","commandType":"auto","position":8.0,"command":"df1 = df.withColumn(\"TableName\", split((\"FilePath\"), \"/\").getItem(6))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"152b0f7b-c7c8-436a-8844-7ccb48186e44"},{"version":"CommandV1","origId":2709619314155056,"guid":"605a23db-e752-46c3-9a70-e82eef3b4460","subtype":"command","commandType":"auto","position":9.0,"command":"newDf = df1.withColumn('FileName', regexp_replace('FileNameRaw', '%23', '#'))\ndisplay(newDf[[\"FileName\", \"TableName\", \"Row_Count_per_file\"]])","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"41486d55-b6b3-4f9b-abb8-501301aae3d3"},{"version":"CommandV1","origId":2709619314155057,"guid":"0896ddfd-a069-428d-88ed-4e414c19897c","subtype":"command","commandType":"auto","position":10.0,"command":"%md\n# Total File Counts","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"86795780-04cc-47a8-b881-8b1b8f36b1c0"},{"version":"CommandV1","origId":2709619314155058,"guid":"4af1f271-8ae8-401c-9c49-1dede0b41a6c","subtype":"command","commandType":"auto","position":11.0,"command":"newDf.count()","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6b88b6b5-3e0f-4734-ac41-f13e78c3a660"},{"version":"CommandV1","origId":2709619314155059,"guid":"d22a4016-308a-44be-b4bb-2cd1e51d05ba","subtype":"command","commandType":"auto","position":12.0,"command":"%md\n# Count of Files per Table","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"41d60717-bcef-4dd7-8659-ec25f5936348"},{"version":"CommandV1","origId":2709619314155060,"guid":"7f370cf0-b950-411d-9888-32b4c9d74cc4","subtype":"command","commandType":"auto","position":13.0,"command":"newDf2 =  newDf \\\n    .groupby(\"TableName\") \\\n    .agg(F.count(\"*\").alias(\"File_Count_per_Table\"))\ndisplay(newDf2[[\"TableName\",\"File_Count_per_Table\"]])","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"faef8308-3e90-4ad9-87fd-f604df4ff420"},{"version":"CommandV1","origId":2709619314155061,"guid":"3ced5dfa-77e7-448e-a158-bab2a14a3a7a","subtype":"command","commandType":"auto","position":14.0,"command":"%md\n# Rows per table","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9f023595-374b-4225-8f53-728a425cd823"},{"version":"CommandV1","origId":2709619314155062,"guid":"6a49e335-7282-48e9-9683-ebd91eedf1c5","subtype":"command","commandType":"auto","position":15.0,"command":"newDf3 =  newDf \\\n    .groupby(\"TableName\") \\\n    .agg(F.sum(\"Row_Count_per_file\").alias(\"Row_Count_per_Table\"))\ndisplay(newDf3[[\"TableName\",\"Row_Count_per_Table\"]])","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cfc674b3-aadf-4234-8996-347a52b0d926"},{"version":"CommandV1","origId":2709619314155063,"guid":"a32d7daf-2be9-4e4e-9282-edf05ab74c62","subtype":"command","commandType":"auto","position":16.0,"command":"%md\n# History tables stats","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"98d7ce33-3c0b-40f0-9044-ae194a883ae3"},{"version":"CommandV1","origId":2709619314155064,"guid":"78cbf399-4001-4be0-a83c-50a306068157","subtype":"command","commandType":"auto","position":17.0,"command":"\ndftablename = spark.sql(f\"\"\"SHOW TABLES FROM cods_nonprod_historical like '*archive';\"\"\")\n#display(dftablename)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c2b83eac-7bd2-4d4f-b350-5c75685982bd"},{"version":"CommandV1","origId":2709619314155065,"guid":"5ca6f4ac-9eeb-43ea-88cd-317561244f08","subtype":"command","commandType":"auto","position":18.0,"command":"from pyspark.sql import SparkSession\nfrom pyspark.sql.types import *\nfrom pyspark.sql.functions import col\nfrom pyspark.sql.functions import lit\n\nspark = SparkSession.builder.appName('Empty_Dataframe').getOrCreate()\n\ncolumns = StructType([StructField('TOTAL_ROW_COUNT',\n                                  StringType(), True),\n                    StructField('TODAYS_MERGED_COUNT',\n                                  StringType(), True),\n                    StructField('TABLE_NAME',\n                                StringType(), True),\n                    StructField('DATABASE',\n                                StringType(), True)])\n\nempRDD = spark.sparkContext.emptyRDD()\n\ndffn1 = spark.createDataFrame(data = empRDD , schema = columns)\n\ndf_collect = dftablename.collect()\nfor row in df_collect:\n    var_db = row[\"database\"]\n    var_tn = row[\"tableName\"]\n    dffn2 = spark.sql(f\"\"\"SELECT  COUNT(*) as TOTAL_ROW_COUNT ,(SELECT  COUNT(*) FROM {var_db}.{var_tn} WHERE date(EDA_Creation_date) = current_date()) as TODAYS_MERGED_COUNT FROM {var_db}.{var_tn}\"\"\")    \n    dffn3 = dffn2.withColumn(\"TableName\",lit(var_tn))\n    dffn4 = dffn3.withColumn(\"Database\",lit(var_db))\n    dffn1 = dffn1.union(dffn4)\n#display(dffn1)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"540098f2-3d7c-4b46-a92e-f9ed5c6b5bef"},{"version":"CommandV1","origId":2709619314155066,"guid":"f6206548-c7c6-4c99-a248-853535aeac37","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n# Stream tables stats","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"96e34dfa-9876-497a-af37-29228266eb2f"},{"version":"CommandV1","origId":2709619314155067,"guid":"3c9fdd67-02cf-47a2-9c84-28333462b895","subtype":"command","commandType":"auto","position":20.0,"command":"dfstreamtablename = spark.sql(f\"\"\"SHOW TABLES FROM cods_nonprod_active like '*current';\"\"\")\n#display(dfstreamtablename)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9b03586f-e07f-4853-8547-55e300efb2c9"},{"version":"CommandV1","origId":2709619314155068,"guid":"d4eda83f-303d-4cc0-b1fc-a0fe92285555","subtype":"command","commandType":"auto","position":21.0,"command":"from pyspark.sql import SparkSession\nfrom pyspark.sql.types import *\nfrom pyspark.sql.functions import col\nfrom pyspark.sql.functions import lit\n\nspark = SparkSession.builder.appName('Empty_Dataframe').getOrCreate()\n\ncolumns = StructType([StructField('TOTAL_ROW_COUNT',\n                                  StringType(), True),\n                    StructField('TODAYS_MERGED_COUNT',\n                                  StringType(), True),\n                    StructField('TABLE_NAME',\n                                StringType(), True),\n                    StructField('DATABASE',\n                                StringType(), True)])\n\nempRDD = spark.sparkContext.emptyRDD()\n\ndffns1 = spark.createDataFrame(data = empRDD , schema = columns)\n\ndf_s_collect = dfstreamtablename.collect()\nfor row in df_s_collect:\n    var_db = row[\"database\"]\n    var_tn = row[\"tableName\"]\n    dffns2 = spark.sql(f\"\"\"SELECT  COUNT(*) as TOTAL_ROW_COUNT ,(SELECT  COUNT(*) FROM {var_db}.{var_tn} WHERE date(EDA_Creation_date) = current_date()) as TODAYS_MERGED_COUNT FROM {var_db}.{var_tn}\"\"\")    \n    dffns3 = dffns2.withColumn(\"TableName\",lit(var_tn))\n    dffns4 = dffns3.withColumn(\"Database\",lit(var_db))\n    dffns1 = dffns1.union(dffns4)\n#display(dffn1)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9f28380a-35ba-4f0f-aff3-26abfeea44d8"},{"version":"CommandV1","origId":2709619314155069,"guid":"67f38fa6-50f8-4ae5-9298-5ede9ff44775","subtype":"command","commandType":"auto","position":22.0,"command":"%md\n# Collect dataframes and write to excel","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"57db50c8-b7b5-4012-9c5a-c3fb874b8ee2"},{"version":"CommandV1","origId":2709619314155070,"guid":"45659fee-a3dc-411e-b1e0-3859ae31b897","subtype":"command","commandType":"auto","position":23.0,"command":"\nNASrowCountPerFile = newDf[[\"FileName\", \"TableName\", \"Row_Count_per_file\"]]\nNAScountOfFilesPerTable = newDf2\nNASrowPerTable = newDf3\nhistoryTableStats = dffn1\nstreamTableStats = dffns1\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f3a382f1-477f-497e-bcbe-96c9c714ad42"},{"version":"CommandV1","origId":2709619314155071,"guid":"4664121d-80a7-4f46-a4b6-8bfd59f09af7","subtype":"command","commandType":"auto","position":24.0,"command":"#import pandas as pd\nimport datetime\n\ncurrentutctime = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')\nfilenamewithtime = \"STATS_\" + currentutctime +\".xlsx\"\npartitions = datetime.datetime.now().strftime('%Y-%m-%d/')\n\nstatistics_loc_file = statistics_loc + \"/\" + partitions + filenamewithtime\n\nNASrowCountPerFile.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'NASrowCountPerFile'!A1:Z20000\").save(statistics_loc_file)\nNAScountOfFilesPerTable.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'NAScountOfFilesPerTable'!A1:Z20000\").save(statistics_loc_file)\nNASrowPerTable.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'NASrowPerTable'!A1:Z20000\").save(statistics_loc_file)\nhistoryTableStats.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'HistoryTableStats'!A1:Z20000\").save(statistics_loc_file)\nstreamTableStats.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'StreamTableStats'!A1:Z20000\").save(statistics_loc_file)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6fc5b85b-21d9-4b14-9c53-d6f186153d2c"}],"dashboards":[],"guid":"062b7b09-c80f-499f-a463-6dc10d1877b7","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}