{"version":"NotebookV1","origId":2709619314155084,"name":"STD NAS_data_file_movement","language":"python","commands":[{"version":"CommandV1","origId":2709619314155085,"guid":"88ff56ce-6584-4b54-adc5-a0b2e91eadaf","subtype":"command","commandType":"auto","position":2.0,"command":"#%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":2,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"63e4a20d-ab36-4458-b7bb-279b2aaad4aa"},{"version":"CommandV1","origId":2709619314155086,"guid":"46dfa337-1106-4729-b60a-6835ed2a250b","subtype":"command","commandType":"auto","position":3.0,"command":"# SET LOAD TYPE (FULL LOAD = Yes/No)\ndbutils.widgets.text(\"FULL_LOAD\", \"No\", \"FULL LOAD\")\nFULL_LOAD = dbutils.widgets.get(\"FULL_LOAD\")\n\n# SET ENVIRONMENT FOR DATA LAKE (02 OR 10 OR etc)\ndbutils.widgets.text(\"env\", \"02\", \"ADLS ENVIRONMENT\")\nenv = dbutils.widgets.get(\"env\")\n\n#SET BASE PATH\nbasepath = 'abfss://dev@dtecuprodedaadl' + env + '.dfs.core.windows.net/'\n\n#SET STG BACKUP LOCATION\ndbutils.widgets.text(\"staging_backup_loc\", \"raw/ISU_archive/staging_backup\", \"STAGING BACKUP LOC\")\nstaging_backup_loc = basepath + dbutils.widgets.get(\"staging_backup_loc\")\n\n#SET STG LOCATION\ndbutils.widgets.text(\"staging_loc\", \"raw/ISU_archive/staging\", \"STAGING LOC\")\nstaging_loc = basepath + dbutils.widgets.get(\"staging_loc\")\n\n#SET STG COLLECTED LOCATION\ndbutils.widgets.text(\"staging_collected_loc\", \"raw/ISU_archive/staging_collected\", \"STAGING COLLECTED LOC\")\nstaging_collected_loc = basepath + dbutils.widgets.get(\"staging_collected_loc\")\n\n#SET EXTRAS LOCATION\ndbutils.widgets.text(\"extras_loc\", \"raw/ISU_archive/extras\", \"EXTRAS LOC\")\nextras_loc = basepath + dbutils.widgets.get(\"extras_loc\")\n\n#SET SEGREGATED LOCATION\ndbutils.widgets.text(\"segregated_loc\", \"raw/ISU_archive/segregated\", \"SEGREGATED LOC\")\nsegregated_loc = basepath + dbutils.widgets.get(\"segregated_loc\")\n\n#SET METADATA FILEPATH FROM ADLS (For example  = ISU_archive_support/metadata/Final_metadata.csv)\ndbutils.widgets.text(\"metaadlspath\", \"ISU_archive_support/metadata/Final_metadata.csv\", \"METADATA FILE LOC\")\nmetaadlspath = dbutils.widgets.get(\"metaadlspath\")\n\n#SET METADATA FILE FULL PATH TO ADLS\nmetafilepath = basepath + metaadlspath\n\n#SET EXECUTION LOGS LOCATION PATH \ndbutils.widgets.text(\"execution_logs_loc\", \"ISU_archive_support/execution_logs/nas_logs\", \"EXECUTION LOGS LOC\")\nexecution_logs_loc = basepath + dbutils.widgets.get(\"execution_logs_loc\")\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"21cda1eb-335c-442c-9433-c328faae67b3"},{"version":"CommandV1","origId":2709619314155087,"guid":"49febb12-1caf-4d5c-9351-2a7db8d8a5be","subtype":"command","commandType":"auto","position":4.0,"command":"print(\"FULL_LOAD : \" + FULL_LOAD)\nprint(\"basepath : \" + basepath)\nprint(\"staging_backup_loc : \" + staging_backup_loc)\nprint(\"staging_loc : \" + staging_loc)\nprint(\"staging_collected_loc : \" + staging_collected_loc)\nprint(\"extras_loc : \" + extras_loc)\nprint(\"segregated_loc : \" + segregated_loc)\nprint(\"metafilepath : \" + metafilepath)\nprint(\"execution_logs_loc : \" + execution_logs_loc)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f015a4d7-6cad-4f45-9f48-7ea478275c40"},{"version":"CommandV1","origId":2709619314155088,"guid":"6a3984d7-4582-4ad3-8f78-d9ffff49f28c","subtype":"command","commandType":"auto","position":5.0,"command":"#START LOGGING\n\nimport logging\nimport datetime\n\nexecution_logs_loc2 = execution_logs_loc + \"/\"\n\n#ADD FOLDER IF NOT EXIST\ndbutils.fs.mkdirs(execution_logs_loc)\n\ncurrentutctime = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')\nfilenamewithtime = \"EDA_NAS_\" + currentutctime +\".log\"\npartitions = datetime.datetime.now().strftime('%Y-%m-%d/')\n\ndbfslogbasepath = \"/tmp\" + \"/\" + filenamewithtime\n\n#TAG LOGGING INFO TO NOTEBOOK\nlogger = logging.getLogger('NASDataMovement')\n\n#SETTING THRESHOLD OF LOGGER TO INFO\nlogger.setLevel(logging.INFO)\n\nFilehandler = logging.FileHandler(dbfslogbasepath,mode = 'a')\n\nformatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s: %(message)s', datefmt='%m/%d/%Y %I:%M:%S %p')\nFilehandler.setFormatter(formatter)\n\nlogger.addHandler(Filehandler)\n\n#LOG INFO\nlogger.info(\"NAS file movement NoteBook run started \")\nlogger.info(\"Input Parameters >>\")\nlogger.info(\"basepath : \" + basepath + \",\" + \"FULL_LOAD : \" + FULL_LOAD + \",\" + \"staging_backup_loc : \" + staging_backup_loc + \",\" + \"staging_loc : \" + staging_loc + \",\" + \"staging_collected_loc : \" + staging_collected_loc + \",\" + \"extras_loc : \" + extras_loc + \",\" + \"segregated_loc : \" + segregated_loc + \",\" + \"metafilepath : \" + metafilepath + \",\" + \"execution_logs_loc : \" + execution_logs_loc)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4521698b-e894-403c-a853-635e88435906"},{"version":"CommandV1","origId":2709619314155089,"guid":"deff1e8c-885a-404a-b5a7-e84887b26522","subtype":"command","commandType":"auto","position":6.0,"command":"dbutils.fs.mkdirs(staging_backup_loc)\nlogger.info(\"Created staging_backup_loc directory : refer cmd 5\")\ndbutils.fs.mkdirs(staging_loc)\nlogger.info(\"Created staging_loc directory : refer cmd 5\")\ndbutils.fs.mkdirs(extras_loc)\nlogger.info(\"Created extras_loc directory : refer cmd 5\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"842e9079-879a-4adb-bd14-8d2a9d9ddfc0"},{"version":"CommandV1","origId":2709619314155090,"guid":"6154e8cb-5e3d-43b6-a82a-6fb554416348","subtype":"command","commandType":"auto","position":7.0,"command":"dbutils.fs.rm(segregated_loc, True)\nlogger.info(\"Removed segregated_loc directory : refer cmd 6\")\ndbutils.fs.rm(staging_backup_loc, True)\nlogger.info(\"Removed staging_backup_loc directory : refer cmd 6\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"95c494da-c9d9-44c7-8344-77076bb21985"},{"version":"CommandV1","origId":2709619314155091,"guid":"92dda8dc-2eff-44fc-b8f1-41a798699f8f","subtype":"command","commandType":"auto","position":8.0,"command":"dbutils.fs.cp(staging_loc, staging_backup_loc, True)\nlogger.info(\"Copied  staging_loc to staging_backup_loc directory\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"99b9d5d5-8ae8-4d1b-a649-4e91b9d872c5"},{"version":"CommandV1","origId":2709619314155092,"guid":"4b7d348d-3672-46a4-950c-3cf3db3e8c68","subtype":"command","commandType":"auto","position":9.0,"command":"dbutils.fs.cp(staging_loc, staging_collected_loc, True)\nlogger.info(\"Copied  staging_loc to staging_collected_loc directory\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"299b3df7-8303-43a6-aec4-ccb517a4e4d6"},{"version":"CommandV1","origId":2709619314155093,"guid":"d19fcd51-ddda-4492-9725-e7a3cf0b87b8","subtype":"command","commandType":"auto","position":10.0,"command":"%run \"../Metadata/Load_Metadata\"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f2ed0ea8-6669-423b-a523-e50abcba5fa8"},{"version":"CommandV1","origId":2709619314155094,"guid":"e9ab041f-ac56-4990-8be6-4da5becd9f75","subtype":"command","commandType":"auto","position":11.0,"command":"metadf = load_metadata_df(metafilepath)\ndisplay(metadf)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"55f46907-ba16-4961-8b75-e131dfed5431"},{"version":"CommandV1","origId":2709619314155095,"guid":"4a07753e-6913-47aa-99bb-cdedce86687d","subtype":"command","commandType":"auto","position":12.0,"command":"tablelist = metadf.select(\"Table_Name\").distinct().rdd.map(lambda x : x[0]).collect()\nprint(tablelist)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"835a9599-5e5f-4412-95bf-eb4c02118905"},{"version":"CommandV1","origId":2709619314155096,"guid":"5eccb407-8d92-47fe-b7d8-52a5d0c8d674","subtype":"command","commandType":"auto","position":13.0,"command":"if FULL_LOAD == 'Yes':\n  stagingloc = staging_collected_loc\nelse:\n  stagingloc = staging_loc\n\n\nsegregatedloc = segregated_loc\nextrasloc = extras_loc\n\nfileloc = dbutils.fs.ls(stagingloc)\nfilelist = list(map(lambda p: p.name, fileloc))","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fba2096a-b5e7-4e03-b28e-d089f0020539"},{"version":"CommandV1","origId":2709619314155097,"guid":"0d94acd8-a78e-4e1c-ae12-e5566c402246","subtype":"command","commandType":"auto","position":14.0,"command":"def grab_files_for_a_table(table,file_list,stagingloc,segregatedloc):\n  matchphrase = '#' + table + '#'\n  tables_with_data = ''\n  filelistreq = [i for i in file_list if any(i for j in [matchphrase] if str(j) in i)]\n  len(filelistreq)\n  if filelistreq:\n    tables_with_data = table\n    for x in filelistreq:\n      #print(stagingloc + '/' + x, segregatedloc + '/' + table + '/' + x)\n      dbutils.fs.cp(stagingloc + '/' + str(x), segregatedloc + '/' + table + '/' + str(x))          \n    return(filelistreq,tables_with_data)\n  else:\n    return(filelistreq,tables_with_data)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f17ef939-4df8-459a-9419-a54f4c0acd47"},{"version":"CommandV1","origId":2709619314155098,"guid":"d564f280-b3a1-4a54-a5a9-947597d415d6","subtype":"command","commandType":"auto","position":15.0,"command":"try:  \n  alldatafiles = []\n  tablelist_with_data = []\n  for y in tablelist:\n    filelistreq,with_data = grab_files_for_a_table(y,filelist,stagingloc,segregatedloc)\n    alldatafiles = alldatafiles + filelistreq\n    tablelist_with_data = tablelist_with_data + [with_data]\n  \n  print(tablelist_with_data)\n  logger.info(\"Files copied from staging to segregated location : refer cmd 14 and 13\")\nexcept Exception as e:\n  logger.error(\"grab_files_for_a_table function failed while executing : refer cmd 14 and 13 : \" + str(e))\n  dbutils.fs.mv(\"file:\" + dbfslogbasepath,execution_logs_loc2 + partitions + filenamewithtime)\n  ","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"52df60ee-0e92-4789-b7fd-73533d6e57b2"},{"version":"CommandV1","origId":2709619314155099,"guid":"cfabc4c3-c528-4224-8b91-3b08eeb26a43","subtype":"command","commandType":"auto","position":16.0,"command":"extrafiles = [item for item in filelist if item not in alldatafiles]\nlen(extrafiles)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5784bd45-76bd-4f2e-b291-2e41dae1d44f"},{"version":"CommandV1","origId":2709619314155100,"guid":"befb3e2e-d5ce-4a3a-af75-9b85967937eb","subtype":"command","commandType":"auto","position":17.0,"command":"extrafiles","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e1255df7-1747-456e-8f96-b7867ce7c439"},{"version":"CommandV1","origId":2709619314155101,"guid":"154faf21-093e-4d0d-9b48-65de16aefd36","subtype":"command","commandType":"auto","position":18.0,"command":"# Copy extra files\nfor x in extrafiles:\n  dbutils.fs.cp(stagingloc + '/' + x, extrasloc + '/' + x)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6fae9d54-2bd6-4e02-ae1b-bae395dcf441"},{"version":"CommandV1","origId":2709619314155102,"guid":"3c5eace8-b06d-41b4-9625-50ef99a0d1bf","subtype":"command","commandType":"auto","position":19.0,"command":"tablelist_with_data = [x for x in tablelist_with_data if x]\nprint(len(tablelist_with_data))\nprint(tablelist_with_data)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"27ee0691-12f4-4670-be21-33f7a5f422f2"},{"version":"CommandV1","origId":2709619314155103,"guid":"56d9115a-daf7-45ee-b287-0454da6e55c5","subtype":"command","commandType":"auto","position":20.0,"command":"dbutils.fs.rm(staging_loc, True)\nlogger.info(\"Staging location removed!\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cc110b51-71f8-4d46-b8ff-9c35a47bfae7"},{"version":"CommandV1","origId":2709619314155104,"guid":"3c6a41c2-752a-451a-9dbd-0cfca0f8ff95","subtype":"command","commandType":"auto","position":21.0,"command":"#LOG INFO\nlogger.info(\"NAS data load Completed Successfully!\")\n\n#MOVE LOG FILE TO ADLS LOCATION\ndbutils.fs.mv(\"file:\" + dbfslogbasepath,execution_logs_loc2 + partitions + filenamewithtime)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"47fce8d7-0fb7-487d-ba68-bdceb72a1db9"}],"dashboards":[],"guid":"b4f30948-528c-4e5f-b4ab-e3652ef5625a","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}