{"version":"NotebookV1","origId":2709619314156455,"name":"STD STREAM_DATA_PREPARATION","language":"python","commands":[{"version":"CommandV1","origId":736389190656342,"guid":"d670f21e-9651-4b3d-a6fb-7399cec4d821","subtype":"command","commandType":"auto","position":26.0,"command":"# keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\n# bronze_with_BATCH_date = bronzedf.drop_duplicates(keyfields)","commandVersion":5,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e086cc58-86d3-4019-b55d-971d7e085db5"},{"version":"CommandV1","origId":2709619314156456,"guid":"b61ed25e-ae06-4979-978d-61d4a7449f3b","subtype":"command","commandType":"auto","position":2.0,"command":"#%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":3,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ae070075-a4ee-4ead-920c-4ea4d257ffb6"},{"version":"CommandV1","origId":2709619314156457,"guid":"5b39f8f4-89e1-492c-8635-2850763f877b","subtype":"command","commandType":"auto","position":3.0,"command":"from pyspark.sql.functions import *\nfrom pyspark.sql.window import Window\nimport fnmatch","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663837408069,"submitTime":1663837408008,"finishTime":1663837408090,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"04bcbbb4-8940-4551-a763-fb644437abd9"},{"version":"CommandV1","origId":2709619314156458,"guid":"98cd673d-d4c0-4592-b4ae-28541fc5084f","subtype":"command","commandType":"auto","position":4.0,"command":"# SET TABLE NAME\ndbutils.widgets.text(\"table_name\", \"\", \"table name\")\ntable_name = dbutils.widgets.get(\"table_name\")\n\n#SET METADATA FILEPATH in ADLS (For Example = abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/ISU_archive_support/metadata/Final_metadata.csv)\ndbutils.widgets.text(\"metafilepath\", \"\", \"METADATA FILEPATH\")\nmetafilepath = dbutils.widgets.get(\"metafilepath\")\n\n# SET STAGING LOCATION ( source here )\ndbutils.widgets.text(\"staging_location\", \"\", \"staging location\")\nstaging_location = dbutils.widgets.get(\"staging_location\") + \"/\" + table_name.lower()\n\n# SET CURATED LOCATION ( destination here )\ndbutils.widgets.text(\"curated_location\", \"\", \"curated location\")\ncurated_location = dbutils.widgets.get(\"curated_location\") + \"/\" + table_name\n\n# SET SILVER LOACATION\ndbutils.widgets.text(\"silver_location\", \"\", \"silver zone\")\nsilver_location = dbutils.widgets.get(\"silver_location\") + \"/\" + table_name\n\n# SET FULL LOAD = Yes/No\ndbutils.widgets.text(\"FULL_LOAD\", \"No\", \"FULL LOAD\")\nFULL_LOAD = dbutils.widgets.get(\"FULL_LOAD\")\n\n# Set DBFS log file path\ndbutils.widgets.text(\"dbfslogbasepath\", \"\", \"DBFS LOG FILE PATH\")\ndbfslogbasepath = dbutils.widgets.get(\"dbfslogbasepath\")\n\n# Set DBFS log second file path\ndbutils.widgets.text(\"n_dbfslogbasepath\", \"\", \"DBFS STATUS LOG FILE PATH\")\nn_dbfslogbasepath = dbutils.widgets.get(\"n_dbfslogbasepath\")\n\n# SET RUN FOR N PREVIOUS DAYS (0 BYDEFAULT, EXAMPLES : 1,2,3,4,5,6..)\ndbutils.widgets.text(\"runsincedate\", \"\", \"RUN SINCE DATE\")\nrunsincedate = dbutils.widgets.get(\"runsincedate\")","commandVersion":3,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{"curated_location":"","table_name":"","metafilepath":"","dbfslogbasepath":"","staging_location":"","n_dbfslogbasepath":"","runsincedate":"","silver_location":"","FULL_LOAD":"No"},"addedWidgets":{"curated_location":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}},"table_name":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}},"metafilepath":{"widgetType":"text","name":"metafilepath","defaultValue":"","label":"METADATA FILEPATH","options":{"widgetType":"text","validationRegex":null}},"dbfslogbasepath":{"widgetType":"text","name":"dbfslogbasepath","defaultValue":"","label":"DBFS LOG FILE PATH","options":{"widgetType":"text","validationRegex":null}},"staging_location":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}},"n_dbfslogbasepath":{"widgetType":"text","name":"n_dbfslogbasepath","defaultValue":"","label":"DBFS STATUS LOG FILE PATH","options":{"widgetType":"text","validationRegex":null}},"runsincedate":{"widgetType":"text","name":"runsincedate","defaultValue":"","label":"RUN SINCE DATE","options":{"widgetType":"text","validationRegex":null}},"silver_location":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver zone","options":{"widgetType":"text","validationRegex":null}},"FULL_LOAD":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"No","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663681251992,"submitTime":1663681251068,"finishTime":1663681252022,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"1401b238-cd38-4faa-9cee-c27f3ecd6393"},{"version":"CommandV1","origId":2709619314156459,"guid":"8a5609f4-43f0-44d9-99c2-ac6636036095","subtype":"command","commandType":"auto","position":5.0,"command":"print(table_name)\nprint(metafilepath)\nprint(staging_location)\nprint(curated_location)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c02abc82-2794-4d77-9d2d-4c16797b5c68"},{"version":"CommandV1","origId":2709619314156460,"guid":"fbd7defe-003b-4445-ac0a-602c17d137d7","subtype":"command","commandType":"auto","position":6.0,"command":"#START LOGGING #1\n\nimport logging\nimport datetime\n\n#TAG LOGGING INFO TO NOTEBOOK\nlogger = logging.getLogger('DataPreparationNotebook')\n#SETTING THRESHOLD OF LOGGER TO INFO\nlogger.setLevel(logging.INFO)\nFilehandler = logging.FileHandler(dbfslogbasepath,mode = 'a')\nformatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s: %(message)s', datefmt='%m/%d/%Y %I:%M:%S %p')\nFilehandler.setFormatter(formatter)\nlogger.addHandler(Filehandler)\n#LOG INFO\nlogger.info(\"DataPreparation is Running... \")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d999ad02-d896-43a3-b305-fbc9a70c3724"},{"version":"CommandV1","origId":2709619314156461,"guid":"42ad57ef-e1d0-4818-9c8f-aa9d027e48c7","subtype":"command","commandType":"auto","position":7.0,"command":"# #START LOGGING #2\n\nimport logging\nimport datetime\n#TAG LOGGING INFO TO NOTEBOOK\nn_logger = logging.getLogger('DataPreperationNotebook')\n#SETTING THRESHOLD OF LOGGER TO INFO\nn_logger.setLevel(logging.INFO)\nn_Filehandler = logging.FileHandler(n_dbfslogbasepath,mode = 'a')\nn_formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s: %(message)s', datefmt='%m/%d/%Y %I:%M:%S %p')\nn_Filehandler.setFormatter(n_formatter)\nn_logger.addHandler(n_Filehandler)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"bccc5f11-0ebe-44d6-b709-6cb779684090"},{"version":"CommandV1","origId":2709619314156462,"guid":"25493cf4-d58e-4593-b08e-dc1a56110516","subtype":"command","commandType":"auto","position":8.0,"command":"if (str(FULL_LOAD) == 'Yes'):\n  bronze_loc_cp = curated_location + \"_checkpoint\"\n  bronze_loc = curated_location\n  silver_loc = silver_location\n  print(bronze_loc,bronze_loc_cp,silver_loc, sep='\\n')\n  dbutils.fs.rm(bronze_loc_cp, True)\n  logger.info(\"removed bronze checkpoint directory : refer cmd 6\")\n  dbutils.fs.rm(bronze_loc, True)\n  logger.info(\"removed bronze directory : refer cmd 6\")\n  dbutils.fs.rm(silver_loc, True)\n  logger.info(\"removed silver directory : refer cmd 6\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"30fa5d86-a27a-4e78-a693-498e5f9d94a2"},{"version":"CommandV1","origId":2709619314156463,"guid":"0a0aeb3e-260a-486f-926d-7028f0ab7b0b","subtype":"command","commandType":"auto","position":9.0,"command":"try:\n  s = \"originaldf = spark.readStream.option('ignoreChanges', 'true').format('delta').load(\" + \"'\" + staging_location + \"'\" + \")\"\n  print(s)\n  exec(s)\n  logger.info(\"Reading datafiles from replicate location succeeded : refer cmd 7\")\nexcept Exception as e:\n  logger.error(\"Reading datafiles from replicate location FAILED : refer cmd 7 : \" + str(e))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8e603765-087b-48f4-addf-76902dc8711b"},{"version":"CommandV1","origId":2709619314156464,"guid":"b997f707-9f6a-4077-b2c0-0076911bbbd9","subtype":"command","commandType":"auto","position":10.0,"command":"%run \"../Metadata/Load_Metadata\"","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663837417425,"submitTime":1663837417425,"finishTime":1663837417871,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ef717523-a4ca-48ec-a381-9aa031d30862"},{"version":"CommandV1","origId":2709619314156465,"guid":"589446df-44ab-4c73-a541-a19f67b6bf40","subtype":"command","commandType":"auto","position":11.0,"command":"#metafilepath = 'abfss://dev@dtecuprodedaadl10.dfs.core.windows.net/ISU_archive_support/metadata/Final_metadata.csv'\nmetadf = load_metadata_df(metafilepath)","commandVersion":6,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"metadf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"Source","nullable":true,"type":"string"},{"metadata":{},"name":"Table_Name","nullable":true,"type":"string"},{"metadata":{},"name":"Table_Position","nullable":true,"type":"string"},{"metadata":{},"name":"Field_Name","nullable":true,"type":"string"},{"metadata":{},"name":"Data_Type","nullable":true,"type":"string"},{"metadata":{},"name":"Key_Field","nullable":true,"type":"string"},{"metadata":{},"name":"Description","nullable":true,"type":"string"},{"metadata":{},"name":"Partition_Key","nullable":true,"type":"string"},{"metadata":{},"name":"Partition_Key_Encoding","nullable":true,"type":"string"},{"metadata":{},"name":"delta_types","nullable":false,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663837472534,"submitTime":1663837472501,"finishTime":1663837473107,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4fa44ef0-b726-4432-a826-0cc44138d4fe"},{"version":"CommandV1","origId":2709619314156466,"guid":"11afef78-7b2a-43c7-bbbd-ef3c838038c2","subtype":"command","commandType":"auto","position":12.0,"command":"# keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\nnewdf = originaldf      #.dropDuplicates(keyfields)","commandVersion":4,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"81ce9287-f448-4ae1-ae7f-c73fc12296fb"},{"version":"CommandV1","origId":2709619314156467,"guid":"2820e25a-2a87-4ef6-865f-4a05130f0009","subtype":"command","commandType":"auto","position":13.0,"command":"def generate_code_for_casting_columns_based_on_metadata(metadf,table_name,dfname,newdfname):\n  z = str(\"\")\n  cols = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[0]).collect()\n  col_types = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[1]).collect()\n  for i,j in zip(cols,col_types):\n    i = '\"' + i + '\"'\n    j = '\"' + j + '\"'\n    z = z + ('.withColumn(' + i + ',col(' + i + ').cast(' + j + '))')\n  return(newdfname + ' = ' + dfname + z)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"aaeb2403-522c-480c-bbc4-05ac967b073e"},{"version":"CommandV1","origId":2709619314156468,"guid":"b50903ad-b7cf-4e1b-b52c-ee2021455bef","subtype":"command","commandType":"auto","position":14.0,"command":"try:\n  get_code = generate_code_for_casting_columns_based_on_metadata(metadf,table_name,'newdf','casted_df')\n  exec(get_code)\n  print(get_code)\n  logger.info(\"generate_code_for_casting_columns_based_on_metadata function succeeded : refer cmd 11\")\nexcept Exception as e:\n  logger.error(\"generate_code_for_casting_columns_based_on_metadata function FAILED : refer cmd 11 : \" + str(e))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7e5529e3-ad6c-496e-bd88-7a8aa6396493"},{"version":"CommandV1","origId":2709619314156469,"guid":"8bc6e20d-70a1-408e-9d22-880356112d41","subtype":"command","commandType":"auto","position":15.0,"command":"def generate_code_for_creating_partition_column_based_on_type(metadf,table_name,dfname,newdfname):  \n  # get partition column from metatable\n  col1 = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Partition_Key\") == 'Y').rdd.map(lambda x : x[0]).collect()\n  #print(col1)\n  #print(col1[0])\n  col2 = metadf.select('Partition_Key_Encoding').where(col('Table_Name')==table_name).where(col('Partition_Key') == 'Y').rdd.map(lambda x : x[0]).collect()\n  #print(col2[0])\n  if col1:\n    column_for_partition_logic = col1[0]\n    partition_logic_encoding = int(col2[0])\n  else:\n    column_for_partition_logic = None\n    partition_logic_encoding = None\n  \n  # decide partitioning logic based on encoding, and create partition column \n\n  if partition_logic_encoding == 1:\n    Logic_1 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',expr('substring(\" + column_for_partition_logic + \",length(\" + column_for_partition_logic +\") - 2,length(\" + column_for_partition_logic + \"))'))\"\n    return(Logic_1)\n  elif partition_logic_encoding == 2:\n    Logic_2 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',substring('\" + column_for_partition_logic + \"',1,6))\"\n    return(Logic_2)\n  elif partition_logic_encoding == 3:\n    Logic_3 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',substring('\" + column_for_partition_logic + \"',1,4))\"\n    return(Logic_3)\n  else:\n    Logic_4 = newdfname + \" = \" + dfname\n    return(Logic_4)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8b8ecf9b-97cb-4716-ab5a-ff80f99e8881"},{"version":"CommandV1","origId":2709619314156470,"guid":"2a246f39-8686-400d-8fad-c01f9d3b468e","subtype":"command","commandType":"auto","position":16.0,"command":"try:\n  get_code = generate_code_for_creating_partition_column_based_on_type(metadf,table_name,'casted_df','replicate_df')\n  print(get_code)\n  exec(get_code)\n  logger.info(\"generate_code_for_creating_partition_column_based_on_type function succeeded : refer cmd 13\")\nexcept Exception as e:\n  logger.error(\"generate_code_for_creating_partition_column_based_on_type function FAILED : refer cmd 13  : \" + str(e))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cbae17c0-e2b4-457c-a472-e558c1cdbba5"},{"version":"CommandV1","origId":2709619314156471,"guid":"13e24297-2d52-49e4-8e6c-f7a0975a915a","subtype":"command","commandType":"auto","position":17.0,"command":"replicate_flags_added = replicate_df.withColumn('EPOCH_FLAG',lit('CURRENT')).withColumn(\"EDA_Creation_date\",current_timestamp()).withColumn(\"BATCH_date\",current_date())","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8dc53d7f-63df-422a-8f43-de99c1270536"},{"version":"CommandV1","origId":2709619314156472,"guid":"079edd9c-edd8-46c0-b0e8-a7919d4b6588","subtype":"command","commandType":"auto","position":18.0,"command":"write_df = replicate_flags_added.drop('hdr__created_batch','hdr__modified_batch','hdr__oper','hdr__ts')","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"33d4a8d5-ef1a-44c5-b5fb-cabea0b65fdd"},{"version":"CommandV1","origId":2709619314156474,"guid":"3f9adae7-1c21-4e20-941e-007210a50e99","subtype":"command","commandType":"auto","position":20.0,"command":"#Mrunal alt\ntry:\n  print(curated_location)\n\n  saveloc = f\"{curated_location}\"\n\n  streamQuery = write_df.writeStream.trigger(once=True).format(\"delta\").option(\"checkpointLocation\",f\"{saveloc}_checkpoint\").start(saveloc)\n  streamQuery.awaitTermination()\n  n_logger.info(table_name + \" : Writing data to BRONZE Succeeded\")\nexcept Exception as e:\n  logger.error(\"writeStream FAILED : refer cmd 16 : \" + str(e))\n  n_logger.error(table_name + \" : Writing data to BRONZE FAILED : \" + str(e))","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6c54c549-14b7-4b20-9259-7334e69b8e1d"},{"version":"CommandV1","origId":2709619314156475,"guid":"bd812957-ac58-4031-b3a4-7a9f38ff8916","subtype":"command","commandType":"auto","position":21.0,"command":"try:\n  s = \"bronzedf_entire = spark.read.format('delta').load(\" + \"'\" + curated_location + \"'\" + \")\"\n  exec(s)\n  logger.info(\"Reading all data from Bronze location succeeded : refer cmd 17\")\nexcept Exception as e:\n  logger.error(\"Reading all data from Bronze location FAILED : refer cmd 17 : \" + str(e))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8c83c132-0538-4387-9825-1f90fc6317ae"},{"version":"CommandV1","origId":2709619314156478,"guid":"81741f10-2c22-4dc0-bcd9-813672f00c38","subtype":"command","commandType":"auto","position":24.0,"command":"from datetime import datetime\nif (str(FULL_LOAD) == 'Yes'):\n  bronzedf = bronzedf_entire\n  logger.info(\"Reading from Bronze location for entire data FULL LOAD = Yes, succeeded : refer cmd 20\")\nelse:\n  if runsincedate:\n    bronzedf = bronzedf_entire.where(col(\"BATCH_date\") >=(datetime.strptime(runsincedate,\"%Y-%m-%d\")))\n    logger.info(\"Reading from Bronze location for date set succeeded : refer cmd 20\")\n    #print(bronzedf)\n  else:\n    bronzedf = bronzedf_entire.where(col(\"BATCH_date\") == current_date())\n    logger.info(\"Reading from Bronze location for current date succeeded : refer cmd 20\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8eab8e43-e743-4e0f-ad2a-7c5f89f1b03c"},{"version":"CommandV1","origId":2709619314156479,"guid":"78553b26-c7b5-4216-901d-3c7bbe4b7d78","subtype":"command","commandType":"auto","position":25.0,"command":"print(bronzedf.count())","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"46b3a319-83cd-4208-a2a3-3245ea91bb36"},{"version":"CommandV1","origId":2709619314156481,"guid":"e5a490d6-866f-4d27-981e-5bb74f47c43a","subtype":"command","commandType":"auto","position":27.0,"command":"keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\nbronzedf2 = bronzedf.na.drop(how='any', subset = keyfields)\nbronze_with_BATCH_date = bronzedf2.drop_duplicates(keyfields)","commandVersion":11,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"958e1242-7675-4296-a7e4-e45427aeea9d"},{"version":"CommandV1","origId":2709619314156486,"guid":"3728bcbe-571a-4592-a344-fce2782eb950","subtype":"command","commandType":"auto","position":32.0,"command":"bronze_write_DF = bronze_with_BATCH_date.drop('BATCH_date')","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8450ad57-89b1-4248-b297-1b8906eca529"},{"version":"CommandV1","origId":2709619314156488,"guid":"162e3a59-af57-48de-b918-096864bc2444","subtype":"command","commandType":"auto","position":34.0,"command":"try:\n    from delta.tables import *\n    from pyspark.sql.functions import *\n    spark.conf.set(\"spark.databricks.io.cache.enabled\", \"true\")\n\n    if_partitioned_table = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Partition_Key\") == 'Y').rdd.map(lambda x : x[0]).collect()\n\n    if (str(FULL_LOAD) == 'Yes'):     \n        if if_partitioned_table:\n            s = 'bronze_write_DF.limit(1).write.format(\"delta\").mode(\"overwrite\").partitionBy(\"partitioncol\").save(' + \"'\" + silver_location + \"'\" + ')'\n            exec(s)\n            logger.info(\"Writing to Silver location succeeded : refer cmd 25\")\n            n_logger.info(table_name + \" : Writing data to SILVER Succeeded\")\n        else:\n            s = 'bronze_write_DF.limit(1).write.format(\"delta\").mode(\"overwrite\").save(' + \"'\" + silver_location + \"'\" + ')'\n            exec(s)\n            logger.info(\"Writing to Silver location succeeded : refer cmd 25\")\n            n_logger.info(table_name + \" : Writing data to SILVER Succeeded\")\n\n\n    keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\n    cond = ''\n    exitindex = len(keyfields)-1\n    for i in keyfields:\n        if keyfields.index(i) == exitindex:\n            cond = cond + 'trim(cast(logs.' + i + ' as string)) = trim(cast(newDedupedLogs.' + i + ' as string))'\n        else:\n            cond = cond + 'trim(cast(logs.' + i + ' as string)) = trim(cast(newDedupedLogs.' + i + ' as string))' + ' AND '\n\n    #cond = cond + ' AND logs.EDA_Creation_date < newDedupedLogs.EDA_Creation_date'\n    print(cond)\n\n    s = \"deltaTable = DeltaTable.forPath(spark, \" + \"'\" + silver_location + \"'\" + \")\"\n    exec(s)\n    print(type(deltaTable))\n\n    logger.info(\"Writing to Silver location succeeded : refer cmd 25\")\n    n_logger.info(table_name + \" : Writing data to SILVER Succeeded\")\n\n    newDedupedLogs = bronze_write_DF\n\n    deltaTable.alias(\"logs\").merge(\n      newDedupedLogs.alias(\"newDedupedLogs\"),\n      cond) \\\n    .whenMatchedUpdateAll() \\\n    .whenNotMatchedInsertAll() \\\n    .execute()\n\nexcept Exception as e:\n    logger.error(\"MERGE FAILED FOR SILVER LOCATION : refer cmd 25 : \" + str(e))\n    n_logger.info(table_name + \" : Writing data to SILVER FAILED : \" + str(e))\n  ","commandVersion":62,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7bf312aa-6328-463c-8eb0-141ede8cdbdd"},{"version":"CommandV1","origId":4441117762638743,"guid":"3ba48e9f-e65a-42c4-9580-a66bb2241e41","subtype":"script","commandType":"auto","position":10.25,"command":"","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663837417464,"submitTime":0,"finishTime":1663837417482,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["b997f707-9f6a-4077-b2c0-0076911bbbd9"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c72dfa99-5a5d-4e02-9824-1b5323724f9e"},{"version":"CommandV1","origId":4441117762638744,"guid":"f0c2b642-ecc3-463a-8ef2-033431dcec5a","subtype":"script","commandType":"auto","position":10.5,"command":"","commandVersion":80,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663837417484,"submitTime":0,"finishTime":1663837417502,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["b997f707-9f6a-4077-b2c0-0076911bbbd9"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b79b8f9b-d062-4fd3-b310-8342a785c7a0"},{"version":"CommandV1","origId":4441117762638745,"guid":"e6a892d8-54f9-4886-a510-306594c21128","subtype":"script","commandType":"auto","position":10.75,"command":"","commandVersion":104,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Your Metadata dataframe is loaded\nUse following syntax to grab it\n &lt;new dataframe&gt; = load_metadata_df(&lt;path of metadata csv&gt;) \n\n\nNOTE : csv path parameter is optional as Functions uses default path\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663837417505,"submitTime":0,"finishTime":1663837417519,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["b997f707-9f6a-4077-b2c0-0076911bbbd9"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",237]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"1beb3524-a0fc-41a8-b8e2-72722bf751f1"}],"dashboards":[],"guid":"aa63447b-63f4-45df-a672-be59411fe55d","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"curated_location":{"nuid":"89c73780-9b8a-4ae7-98c2-ed567971bf2d","currentValue":"","widgetInfo":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}}},"table_name":{"nuid":"5dbf02a3-670e-463c-a837-e4587658ef66","currentValue":"","widgetInfo":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}}},"metafilepath":{"nuid":"6dafb6f1-dd9e-42ea-a1c8-c3edbfa3d242","currentValue":"","widgetInfo":{"widgetType":"text","name":"metafilepath","defaultValue":"","label":"METADATA FILEPATH","options":{"widgetType":"text","validationRegex":null}}},"dbfslogbasepath":{"nuid":"a6328946-48c7-4842-a195-0ac864275bd3","currentValue":"","widgetInfo":{"widgetType":"text","name":"dbfslogbasepath","defaultValue":"","label":"DBFS LOG FILE PATH","options":{"widgetType":"text","validationRegex":null}}},"staging_location":{"nuid":"66560d43-1084-4e93-8356-fbe28d74c89b","currentValue":"","widgetInfo":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}}},"n_dbfslogbasepath":{"nuid":"4f1998d2-24df-44bb-827d-7b388117d038","currentValue":"","widgetInfo":{"widgetType":"text","name":"n_dbfslogbasepath","defaultValue":"","label":"DBFS STATUS LOG FILE PATH","options":{"widgetType":"text","validationRegex":null}}},"runsincedate":{"nuid":"4a089afd-c34f-445b-ac8a-ceacf5030456","currentValue":"","widgetInfo":{"widgetType":"text","name":"runsincedate","defaultValue":"","label":"RUN SINCE DATE","options":{"widgetType":"text","validationRegex":null}}},"silver_location":{"nuid":"054091ba-f4e2-42e9-96e8-12a86fe2ec95","currentValue":"","widgetInfo":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver zone","options":{"widgetType":"text","validationRegex":null}}},"FULL_LOAD":{"nuid":"07deee8a-8241-4468-b7ca-6c71f94246cb","currentValue":"","widgetInfo":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"No","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":4,"mostRecentlyExecutedCommandWithImplicitDF":{"commandId":-1,"dataframes":["_sqldf"]}},"reposExportFormat":"SOURCE"}