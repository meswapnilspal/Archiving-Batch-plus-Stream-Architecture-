{"version":"NotebookV1","origId":2842915811751322,"name":"STD Statistics for Data load","language":"python","commands":[{"version":"CommandV1","origId":2842915811751323,"guid":"e92c2d34-2917-4551-9ea3-b76edf97db61","subtype":"command","commandType":"auto","position":2.0,"command":"#%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":2,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"374cb99d-b90a-497e-92c0-5aa95e67d425"},{"version":"CommandV1","origId":2842915811751324,"guid":"e027532a-e3ef-4a06-9f5b-3f4bdcb79ef1","subtype":"command","commandType":"auto","position":3.0,"command":"# SET ENVIRONMENT FOR DATA LAKE (02 OR 10 OR etc)\ndbutils.widgets.text(\"env\", \"02\", \"ADLS ENVIRONMENT\")\nenv = dbutils.widgets.get(\"env\")\n\n#SET BASEPATH\nbasepath = 'abfss://dev@dtecuprodedaadl' + env + '.dfs.core.windows.net/'\n\n#SET SEGREGATED LOCATION PATH \ndbutils.widgets.text(\"segregated_loc\", \"raw/ISU_archive/segregated\", \"SEGREGATED LOC\")\nsegregated_loc = basepath + dbutils.widgets.get(\"segregated_loc\")\n\n#SET TARGET LOCATION PATH FOR LOGGING STATISTICS EXCELS\ndbutils.widgets.text(\"statistics_loc\", \"ISU_archive_support/statistics\", \"STATISTICS LOC\")\nstatistics_loc = basepath + dbutils.widgets.get(\"statistics_loc\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"33a2c0df-d1d3-4e21-8e39-1808d0c02344"},{"version":"CommandV1","origId":2842915811751325,"guid":"64e71a57-1d6b-48bc-8429-e72184fc5b6b","subtype":"command","commandType":"auto","position":4.0,"command":"print(\"basepath : \" + basepath)\nprint(\"segregated_loc : \" + segregated_loc)\nprint(\"statistics_loc : \" + statistics_loc)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"3b126ce9-17a7-4073-a081-9bb7f4ee51b3"},{"version":"CommandV1","origId":2842915811751326,"guid":"186f3848-bb83-4a22-8696-3321c4c9c331","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n\n# Row Count per File","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7fba5f17-9fab-4d32-99c3-ef4df5442c3e"},{"version":"CommandV1","origId":2842915811751327,"guid":"27866888-b4d9-4744-9f58-3b34afd0255c","subtype":"command","commandType":"auto","position":6.0,"command":"from pyspark.sql import functions as F\nfrom pyspark.sql.functions import split\nfrom pyspark.sql.functions import *\n\ndf_csv = spark.read.csv(segregated_loc + \"/*\") \\\n    .withColumn(\"FilePath\", F.input_file_name()) \\\n    .groupby(\"FilePath\") \\\n    .agg(F.count(\"*\").alias(\"Row_Count_per_file\"))","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d8d48f1c-25d3-4948-b05b-fc8c0b9fbdeb"},{"version":"CommandV1","origId":2842915811751328,"guid":"3f4f0d9a-8756-4351-aa50-f99270148bc9","subtype":"command","commandType":"auto","position":7.0,"command":"\ndf = df_csv.withColumn(\"FileNameRaw\", split((\"FilePath\"), \"/\").getItem(7))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"064b7c33-34de-4ce0-ac2c-2fd975218236"},{"version":"CommandV1","origId":2842915811751329,"guid":"0d508b03-f099-434c-b6ed-da981b6b2303","subtype":"command","commandType":"auto","position":8.0,"command":"df1 = df.withColumn(\"TableName\", split((\"FilePath\"), \"/\").getItem(6))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"152b0f7b-c7c8-436a-8844-7ccb48186e44"},{"version":"CommandV1","origId":2842915811751330,"guid":"61ded17b-84b0-466c-b73a-e7d1a43e9568","subtype":"command","commandType":"auto","position":9.0,"command":"newDf = df1.withColumn('FileName', regexp_replace('FileNameRaw', '%23', '#'))\ndisplay(newDf[[\"FileName\", \"TableName\", \"Row_Count_per_file\"]])","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"41486d55-b6b3-4f9b-abb8-501301aae3d3"},{"version":"CommandV1","origId":2842915811751331,"guid":"21787171-eb3e-473d-a500-2c686e1bace9","subtype":"command","commandType":"auto","position":10.0,"command":"%md\n# Total File Counts","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"86795780-04cc-47a8-b881-8b1b8f36b1c0"},{"version":"CommandV1","origId":2842915811751332,"guid":"13a4c792-4bd4-4b23-aec2-1c969f27ba36","subtype":"command","commandType":"auto","position":11.0,"command":"newDf.count()","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6b88b6b5-3e0f-4734-ac41-f13e78c3a660"},{"version":"CommandV1","origId":2842915811751333,"guid":"c6972e52-17be-4a8e-b597-0f0e908a3eba","subtype":"command","commandType":"auto","position":12.0,"command":"%md\n# Count of Files per Table","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"41d60717-bcef-4dd7-8659-ec25f5936348"},{"version":"CommandV1","origId":2842915811751334,"guid":"0baf2dd1-3adf-4b46-b75f-833eb6e8588e","subtype":"command","commandType":"auto","position":13.0,"command":"newDf2 =  newDf \\\n    .groupby(\"TableName\") \\\n    .agg(F.count(\"*\").alias(\"File_Count_per_Table\"))\ndisplay(newDf2[[\"TableName\",\"File_Count_per_Table\"]])","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"faef8308-3e90-4ad9-87fd-f604df4ff420"},{"version":"CommandV1","origId":2842915811751335,"guid":"6c025b1a-31ff-4ff2-a512-7d374bc55b7f","subtype":"command","commandType":"auto","position":14.0,"command":"%md\n# Rows per table","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9f023595-374b-4225-8f53-728a425cd823"},{"version":"CommandV1","origId":2842915811751336,"guid":"992e3428-27a9-4f63-be92-de83d9654ada","subtype":"command","commandType":"auto","position":15.0,"command":"newDf3 =  newDf \\\n    .groupby(\"TableName\") \\\n    .agg(F.sum(\"Row_Count_per_file\").alias(\"Row_Count_per_Table\"))\ndisplay(newDf3[[\"TableName\",\"Row_Count_per_Table\"]])","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cfc674b3-aadf-4234-8996-347a52b0d926"},{"version":"CommandV1","origId":2842915811751337,"guid":"b45f5bcf-3ea1-4075-83f7-130bd021d707","subtype":"command","commandType":"auto","position":16.0,"command":"%md\n# History tables stats","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"98d7ce33-3c0b-40f0-9044-ae194a883ae3"},{"version":"CommandV1","origId":2842915811751338,"guid":"0e5f1438-da84-4908-bcb8-0ec61e58ac98","subtype":"command","commandType":"auto","position":17.0,"command":"\ndftablename = spark.sql(f\"\"\"SHOW TABLES FROM cods_nonprod_historical like '*archive';\"\"\")\n#display(dftablename)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c2b83eac-7bd2-4d4f-b350-5c75685982bd"},{"version":"CommandV1","origId":2842915811751339,"guid":"db3ffb25-f746-4328-b786-a5b4c5009aaa","subtype":"command","commandType":"auto","position":18.0,"command":"from pyspark.sql import SparkSession\nfrom pyspark.sql.types import *\nfrom pyspark.sql.functions import col\nfrom pyspark.sql.functions import lit\n\nspark = SparkSession.builder.appName('Empty_Dataframe').getOrCreate()\n\ncolumns = StructType([StructField('TOTAL_ROW_COUNT',\n                                  StringType(), True),\n                    StructField('TODAYS_MERGED_COUNT',\n                                  StringType(), True),\n                    StructField('TABLE_NAME',\n                                StringType(), True),\n                    StructField('DATABASE',\n                                StringType(), True)])\n\nempRDD = spark.sparkContext.emptyRDD()\n\ndffn1 = spark.createDataFrame(data = empRDD , schema = columns)\n\ndf_collect = dftablename.collect()\nfor row in df_collect:\n    var_db = row[\"database\"]\n    var_tn = row[\"tableName\"]\n    dffn2 = spark.sql(f\"\"\"SELECT  COUNT(*) as TOTAL_ROW_COUNT ,(SELECT  COUNT(*) FROM {var_db}.{var_tn} WHERE date(EDA_Creation_date) = current_date()) as TODAYS_MERGED_COUNT FROM {var_db}.{var_tn}\"\"\")    \n    dffn3 = dffn2.withColumn(\"TableName\",lit(var_tn))\n    dffn4 = dffn3.withColumn(\"Database\",lit(var_db))\n    dffn1 = dffn1.union(dffn4)\n#display(dffn1)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"540098f2-3d7c-4b46-a92e-f9ed5c6b5bef"},{"version":"CommandV1","origId":2842915811751340,"guid":"6ca822f3-6a65-49f9-a1ce-b4d14b1cdf68","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n# Stream tables stats","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"96e34dfa-9876-497a-af37-29228266eb2f"},{"version":"CommandV1","origId":2842915811751341,"guid":"5fdeec42-9933-4bd2-99b3-4dfa4328cabd","subtype":"command","commandType":"auto","position":20.0,"command":"dfstreamtablename = spark.sql(f\"\"\"SHOW TABLES FROM cods_nonprod_active like '*current';\"\"\")\n#display(dfstreamtablename)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9b03586f-e07f-4853-8547-55e300efb2c9"},{"version":"CommandV1","origId":2842915811751342,"guid":"63acea65-2654-405e-a4d5-ee6c7b41c8c3","subtype":"command","commandType":"auto","position":21.0,"command":"from pyspark.sql import SparkSession\nfrom pyspark.sql.types import *\nfrom pyspark.sql.functions import col\nfrom pyspark.sql.functions import lit\n\nspark = SparkSession.builder.appName('Empty_Dataframe').getOrCreate()\n\ncolumns = StructType([StructField('TOTAL_ROW_COUNT',\n                                  StringType(), True),\n                    StructField('TODAYS_MERGED_COUNT',\n                                  StringType(), True),\n                    StructField('TABLE_NAME',\n                                StringType(), True),\n                    StructField('DATABASE',\n                                StringType(), True)])\n\nempRDD = spark.sparkContext.emptyRDD()\n\ndffns1 = spark.createDataFrame(data = empRDD , schema = columns)\n\ndf_s_collect = dfstreamtablename.collect()\nfor row in df_s_collect:\n    var_db = row[\"database\"]\n    var_tn = row[\"tableName\"]\n    dffns2 = spark.sql(f\"\"\"SELECT  COUNT(*) as TOTAL_ROW_COUNT ,(SELECT  COUNT(*) FROM {var_db}.{var_tn} WHERE date(EDA_Creation_date) = current_date()) as TODAYS_MERGED_COUNT FROM {var_db}.{var_tn}\"\"\")    \n    dffns3 = dffns2.withColumn(\"TableName\",lit(var_tn))\n    dffns4 = dffns3.withColumn(\"Database\",lit(var_db))\n    dffns1 = dffns1.union(dffns4)\n#display(dffn1)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9f28380a-35ba-4f0f-aff3-26abfeea44d8"},{"version":"CommandV1","origId":2842915811751343,"guid":"0e2fe56f-3510-4f90-bd00-756e9228819a","subtype":"command","commandType":"auto","position":22.0,"command":"%md\n# Collect dataframes and write to excel","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"57db50c8-b7b5-4012-9c5a-c3fb874b8ee2"},{"version":"CommandV1","origId":2842915811751344,"guid":"58ad3e17-756a-4a8e-8b9c-7fade13783fd","subtype":"command","commandType":"auto","position":23.0,"command":"\nNASrowCountPerFile = newDf[[\"FileName\", \"TableName\", \"Row_Count_per_file\"]]\nNAScountOfFilesPerTable = newDf2\nNASrowPerTable = newDf3\nhistoryTableStats = dffn1\nstreamTableStats = dffns1\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f3a382f1-477f-497e-bcbe-96c9c714ad42"},{"version":"CommandV1","origId":2842915811751345,"guid":"2c2fa85e-67f4-4633-bb9b-b4cd69be26e7","subtype":"command","commandType":"auto","position":24.0,"command":"#import pandas as pd\nimport datetime\n\ncurrentutctime = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')\nfilenamewithtime = \"STATS_\" + currentutctime +\".xlsx\"\npartitions = datetime.datetime.now().strftime('%Y-%m-%d/')\n\nstatistics_loc_file = statistics_loc + \"/\" + partitions + filenamewithtime\n\nNASrowCountPerFile.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'NASrowCountPerFile'!A1:Z20000\").save(statistics_loc_file)\nNAScountOfFilesPerTable.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'NAScountOfFilesPerTable'!A1:Z20000\").save(statistics_loc_file)\nNASrowPerTable.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'NASrowPerTable'!A1:Z20000\").save(statistics_loc_file)\nhistoryTableStats.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'HistoryTableStats'!A1:Z20000\").save(statistics_loc_file)\nstreamTableStats.write.mode(\"append\").format(\"com.crealytics.spark.excel\").option(\"header\",True).option(\"dataAddress\",\"'StreamTableStats'!A1:Z20000\").save(statistics_loc_file)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6fc5b85b-21d9-4b14-9c53-d6f186153d2c"}],"dashboards":[],"guid":"f96f1831-3763-479c-8bc4-04e5253121e1","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}