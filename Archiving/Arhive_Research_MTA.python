{"version":"NotebookV1","origId":2709619314156515,"name":"Arhive_Research_MTA","language":"python","commands":[{"version":"CommandV1","origId":2709619314156516,"guid":"40ad2b45-7981-40a3-ba18-cc1ebf96a926","subtype":"command","commandType":"auto","position":2.0,"command":"#%run \"/EDA/Data Engineer/Framework/Secrets-Databricks-Cache\"","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663764511004,"submitTime":1663764510970,"finishTime":1663764511021,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b6cfec15-6a46-40ee-827d-28634d6df4d8"},{"version":"CommandV1","origId":2709619314156517,"guid":"1337ef1a-3fc5-4f6a-b867-19467ad2b4b5","subtype":"command","commandType":"auto","position":3.0,"command":"from pyspark.sql.functions import *\nfrom pyspark.sql.window import Window\nimport fnmatch","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663764511119,"submitTime":1663764511081,"finishTime":1663764511142,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e8a76b57-f3a6-45e7-b789-c7fa1acac0ed"},{"version":"CommandV1","origId":2709619314156518,"guid":"578f07c9-8dd5-48c2-8c8b-acadc296bd5c","subtype":"command","commandType":"auto","position":4.0,"command":"# Table Name\ndbutils.widgets.text(\"table_name\", \"\", \"table name\")\ntable_name = dbutils.widgets.get(\"table_name\")\n\n#SET METADATA FILEPATH in ADLS (For Example = abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/ISU_archive_support/metadata/Final_metadata.csv)\ndbutils.widgets.text(\"metafilepath\", \"\", \"METADATA FILEPATH\")\nmetafilepath = dbutils.widgets.get(\"metafilepath\")\n\n# Staging location ( source here )\ndbutils.widgets.text(\"staging_location\", \"\", \"staging location\")\nstaging_location = \"'\" + dbutils.widgets.get(\"staging_location\") + \"/\" + table_name + \"/'\"\n\n# Curated location ( destination here )\ndbutils.widgets.text(\"curated_location\", \"\", \"curated location\")\ncurated_location = \"'\" + dbutils.widgets.get(\"curated_location\") + \"/\" + table_name + \"/'\"\n\n# Silver location ( final table destination here )\ndbutils.widgets.text(\"silver_location\", \"\", \"silver location\")\nsilver_location = \"'\" + dbutils.widgets.get(\"silver_location\") + \"/\" + table_name + \"/'\"\n\n# Curated location for Error Table\ndbutils.widgets.text(\"curated_location_err\", \"\", \"curated location for error table\")\ncurated_location_err = \"'\" + dbutils.widgets.get(\"curated_location_err\") + \"/\" + table_name + \"/'\"\n\n# Set FULL_LOAD param with Yes/No\ndbutils.widgets.text(\"FULL_LOAD\", \"No\", \"FULL LOAD\")\nFULL_LOAD = dbutils.widgets.get(\"FULL_LOAD\")\n\n# Set DBFS log file path\ndbutils.widgets.text(\"dbfslogbasepath\", \"\", \"DBFS LOG FILE PATH\")\ndbfslogbasepath = dbutils.widgets.get(\"dbfslogbasepath\")\n","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{"curated_location":"","table_name":"ERDB","metafilepath":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/ISU_archive_support/metadata/Final_metadata.csv","dbfslogbasepath":"dbfs:/FileStore/ERDB/","staging_location":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/FileStore/","curated_location_err":"","silver_location":"","FULL_LOAD":"No"},"addedWidgets":{"curated_location":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}},"table_name":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}},"metafilepath":{"widgetType":"text","name":"metafilepath","defaultValue":"","label":"METADATA FILEPATH","options":{"widgetType":"text","validationRegex":null}},"dbfslogbasepath":{"widgetType":"text","name":"dbfslogbasepath","defaultValue":"","label":"DBFS LOG FILE PATH","options":{"widgetType":"text","validationRegex":null}},"staging_location":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}},"curated_location_err":{"widgetType":"text","name":"curated_location_err","defaultValue":"","label":"curated location for error table","options":{"widgetType":"text","validationRegex":null}},"silver_location":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver location","options":{"widgetType":"text","validationRegex":null}},"FULL_LOAD":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"No","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663764511247,"submitTime":1663764511213,"finishTime":1663764511268,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0baaf449-3cf0-4a4e-ad7a-76574bd710d5"},{"version":"CommandV1","origId":2709619314156519,"guid":"89469a23-e8c4-41df-8b0f-a55449dc5387","subtype":"command","commandType":"auto","position":5.0,"command":"print(table_name)\nprint(metafilepath)\nprint(staging_location)\nprint(curated_location)\nprint(curated_location_err)\nprint(silver_location)","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">ERDB\nabfss://dev@dtecuprodedaadl02.dfs.core.windows.net/ISU_archive_support/metadata/Final_metadata.csv\n&#39;abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/FileStore//ERDB/&#39;\n&#39;/ERDB/&#39;\n&#39;/ERDB/&#39;\n&#39;/ERDB/&#39;\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663764511392,"submitTime":1663764511361,"finishTime":1663764511410,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",260]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fa324d7c-7da3-4375-9f65-ba2716c550a0"},{"version":"CommandV1","origId":2709619314156521,"guid":"5c887c5d-87bd-4206-ab77-c2773a5dd4ca","subtype":"command","commandType":"auto","position":7.0,"command":"try:\n    s = 'newdf = spark.read.format(\"csv\").option(\"delimiter\", \"|\").option(\"header\",\"true\").option(\"inferSchema\",\"true\").load(' + staging_location + ')'\n    print(s)\n    exec(s)\n    #logger.info(\"Reading datafiles from segregated location succeeded : refer cmd 6\")\nexcept Exception as e:\n    print(\"error here\")\n","commandVersion":30,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">newdf = spark.read.format(&#34;csv&#34;).option(&#34;delimiter&#34;, &#34;|&#34;).option(&#34;header&#34;,&#34;true&#34;).option(&#34;inferSchema&#34;,&#34;true&#34;).load(&#39;abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/FileStore//ERDB/&#39;)\nerror here\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1663764538287,"submitTime":1663764538253,"finishTime":1663764538346,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",289]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b8e98643-eff8-48c2-975a-b402763b767d"},{"version":"CommandV1","origId":2709619314156522,"guid":"f57da842-f9e7-4b6a-86e4-2b18b375b6e6","subtype":"command","commandType":"auto","position":8.0,"command":"# FUNCTION TO CLEAN HEADER WITH PROPER COLUMN NAMES FROM DATAFRAME\n\ndef revisit_header(df=newdf,table_n=table_name):\n    if fnmatch.fnmatch(df.columns[0],table_n + \"*\") == True:\n        for i in df.columns:\n            df = df.withColumnRenamed(i, i[len(table_n)+1:])\n        print(df.columns)\n        return df\n    else:\n        return df","commandVersion":1,"state":"error","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"<span class=\"ansi-red-fg\">NameError</span>: name &#39;newdf&#39; is not defined","errorTraceType":"html","error":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansi-green-fg\">&lt;command-2709619314156522&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      1</span> <span class=\"ansi-red-fg\"># FUNCTION TO CLEAN HEADER WITH PROPER COLUMN NAMES FROM DATAFRAME</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      2</span> \n<span class=\"ansi-green-fg\">----&gt; 3</span><span class=\"ansi-red-fg\"> </span><span class=\"ansi-green-fg\">def</span> revisit_header<span class=\"ansi-blue-fg\">(</span>df<span class=\"ansi-blue-fg\">=</span>newdf<span class=\"ansi-blue-fg\">,</span>table_n<span class=\"ansi-blue-fg\">=</span>table_name<span class=\"ansi-blue-fg\">)</span><span class=\"ansi-blue-fg\">:</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      4</span>     <span class=\"ansi-green-fg\">if</span> fnmatch<span class=\"ansi-blue-fg\">.</span>fnmatch<span class=\"ansi-blue-fg\">(</span>df<span class=\"ansi-blue-fg\">.</span>columns<span class=\"ansi-blue-fg\">[</span><span class=\"ansi-cyan-fg\">0</span><span class=\"ansi-blue-fg\">]</span><span class=\"ansi-blue-fg\">,</span>table_n <span class=\"ansi-blue-fg\">+</span> <span class=\"ansi-blue-fg\">&#34;*&#34;</span><span class=\"ansi-blue-fg\">)</span> <span class=\"ansi-blue-fg\">==</span> <span class=\"ansi-green-fg\">True</span><span class=\"ansi-blue-fg\">:</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      5</span>         <span class=\"ansi-green-fg\">for</span> i <span class=\"ansi-green-fg\">in</span> df<span class=\"ansi-blue-fg\">.</span>columns<span class=\"ansi-blue-fg\">:</span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name &#39;newdf&#39; is not defined</div>","workflows":[],"startTime":1663764190136,"submitTime":1663764190136,"finishTime":1663764191261,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"726b87fc-22bb-4a22-b541-e29d410022c7"},{"version":"CommandV1","origId":2709619314156523,"guid":"04069ac6-9393-4dfa-86bf-86f19ffc422f","subtype":"command","commandType":"auto","position":9.0,"command":"newdf = revisit_header()","commandVersion":1,"state":"error","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"<span class=\"ansi-red-fg\">NameError</span>: name &#39;revisit_header&#39; is not defined","errorTraceType":"html","error":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansi-green-fg\">&lt;command-2709619314156523&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span><span class=\"ansi-red-fg\"> </span>newdf <span class=\"ansi-blue-fg\">=</span> revisit_header<span class=\"ansi-blue-fg\">(</span><span class=\"ansi-blue-fg\">)</span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name &#39;revisit_header&#39; is not defined</div>","workflows":[],"startTime":1663764190276,"submitTime":1663764190276,"finishTime":1663764191286,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5f5c2135-f7c8-4f13-bd14-3721b2883a97"},{"version":"CommandV1","origId":2709619314156524,"guid":"1827be18-b739-4b6b-aefa-5f87942a2e41","subtype":"command","commandType":"auto","position":10.0,"command":"# display(newdf)\ncols_from_file_source = newdf.columns","commandVersion":1,"state":"error","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"<span class=\"ansi-red-fg\">NameError</span>: name &#39;newdf&#39; is not defined","errorTraceType":"html","error":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansi-green-fg\">&lt;command-2709619314156524&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      1</span> <span class=\"ansi-red-fg\"># display(newdf)</span>\n<span class=\"ansi-green-fg\">----&gt; 2</span><span class=\"ansi-red-fg\"> </span>cols_from_file_source <span class=\"ansi-blue-fg\">=</span> newdf<span class=\"ansi-blue-fg\">.</span>columns\n\n<span class=\"ansi-red-fg\">NameError</span>: name &#39;newdf&#39; is not defined</div>","workflows":[],"startTime":1663764190414,"submitTime":1663764190414,"finishTime":1663764191356,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e02b2e53-d493-460f-b560-260b9add72b7"},{"version":"CommandV1","origId":2709619314156525,"guid":"94bfd453-0871-43b2-8280-e570745e28f1","subtype":"command","commandType":"auto","position":11.0,"command":"%run \"../Metadata/Load_Metadata\"","commandVersion":1,"state":"error","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"Notebook not found: Shared/POD_7_Dev/Metadata/Load_Metadata. Notebooks can be specified via a relative path (./Notebook or ../folder/Notebook) or via an absolute path (/Abs/Path/to/Notebook). Make sure you are specifying the path correctly.\n\nStacktrace:\n  /Shared/POD_7_Dev/Archiving/Arhive_Research_MTA: python","errorTraceType":null,"error":null,"workflows":[],"startTime":1663764190591,"submitTime":1663764190591,"finishTime":1663764190597,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"98e5bc0f-bc98-48e4-8d8d-435a894ade1d"},{"version":"CommandV1","origId":2709619314156526,"guid":"37756b77-4e95-48d5-a257-804eaaad1ea6","subtype":"command","commandType":"auto","position":12.0,"command":"metadf = load_metadata_df(metafilepath)\n# display(metadf)","commandVersion":1,"state":"error","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"<span class=\"ansi-red-fg\">NameError</span>: name &#39;load_metadata_df&#39; is not defined","errorTraceType":"html","error":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansi-green-fg\">&lt;command-2709619314156526&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span><span class=\"ansi-red-fg\"> </span>metadf <span class=\"ansi-blue-fg\">=</span> load_metadata_df<span class=\"ansi-blue-fg\">(</span>metafilepath<span class=\"ansi-blue-fg\">)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      2</span> <span class=\"ansi-red-fg\"># display(metadf)</span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name &#39;load_metadata_df&#39; is not defined</div>","workflows":[],"startTime":1663764190715,"submitTime":1663764190715,"finishTime":1663764191382,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"97d0ed51-c7e4-4edf-9c1c-7b850c2a7717"},{"version":"CommandV1","origId":2709619314156527,"guid":"1a64f661-1a2b-48cc-a6d8-52643f187648","subtype":"command","commandType":"auto","position":13.0,"command":"cols_from_metadata = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[0]).collect()\nprint(cols_from_metadata)","commandVersion":1,"state":"error","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"<span class=\"ansi-red-fg\">NameError</span>: name &#39;metadf&#39; is not defined","errorTraceType":"html","error":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansi-green-fg\">&lt;command-2709619314156527&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n<span class=\"ansi-green-fg\">----&gt; 1</span><span class=\"ansi-red-fg\"> </span>cols_from_metadata <span class=\"ansi-blue-fg\">=</span> metadf<span class=\"ansi-blue-fg\">.</span>select<span class=\"ansi-blue-fg\">(</span><span class=\"ansi-blue-fg\">&#34;Field_Name&#34;</span><span class=\"ansi-blue-fg\">)</span><span class=\"ansi-blue-fg\">.</span>where<span class=\"ansi-blue-fg\">(</span>col<span class=\"ansi-blue-fg\">(</span><span class=\"ansi-blue-fg\">&#34;Table_Name&#34;</span><span class=\"ansi-blue-fg\">)</span><span class=\"ansi-blue-fg\">==</span>table_name<span class=\"ansi-blue-fg\">)</span><span class=\"ansi-blue-fg\">.</span>rdd<span class=\"ansi-blue-fg\">.</span>map<span class=\"ansi-blue-fg\">(</span><span class=\"ansi-green-fg\">lambda</span> x <span class=\"ansi-blue-fg\">:</span> x<span class=\"ansi-blue-fg\">[</span><span class=\"ansi-cyan-fg\">0</span><span class=\"ansi-blue-fg\">]</span><span class=\"ansi-blue-fg\">)</span><span class=\"ansi-blue-fg\">.</span>collect<span class=\"ansi-blue-fg\">(</span><span class=\"ansi-blue-fg\">)</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      2</span> print<span class=\"ansi-blue-fg\">(</span>cols_from_metadata<span class=\"ansi-blue-fg\">)</span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name &#39;metadf&#39; is not defined</div>","workflows":[],"startTime":1663764190927,"submitTime":1663764190927,"finishTime":1663764191142,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"980f4afb-f8f6-4446-ae0e-15445895ec97"},{"version":"CommandV1","origId":2709619314156528,"guid":"4422203f-7f51-49c1-9c0f-4b3d5cbf255b","subtype":"command","commandType":"auto","position":14.0,"command":"print(cols_from_file_source)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a1ceab8e-cbf0-4841-9319-12fb498857dd"},{"version":"CommandV1","origId":2709619314156529,"guid":"91699c09-af86-4134-8091-0197a0ba1728","subtype":"command","commandType":"auto","position":15.0,"command":"# try:\n#   test_list1 = sorted(cols_from_file_source)\n#   test_list2 = sorted(cols_from_metadata)\n#   print(\"Schema Matches !!\")\n# except:\n#   print(\"Mismatch in schema\" + table_name)\n#   #dbutils.notebook.exit('stop')","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e719caa1-3113-4898-a861-77ce39b1ea1d"},{"version":"CommandV1","origId":2709619314156530,"guid":"f7abe100-f80d-4e1f-9adc-0c97abaf5a71","subtype":"command","commandType":"auto","position":16.0,"command":"def generate_code_for_casting_columns_based_on_metadata(metadf,table_name,dfname,newdfname):\n  z = str(\"\")\n  cols = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[0]).collect()\n  col_types = metadf.select(\"Field_Name\",\"delta_types\").where(col(\"Table_Name\")==table_name).rdd.map(lambda x : x[1]).collect()\n  for i,j in zip(cols,col_types):\n    i = '\"' + i + '\"'\n    j = '\"' + j + '\"'\n    z = z + ('.withColumn(' + i + ',col(' + i + ').cast(' + j + '))')\n  return(newdfname + ' = ' + dfname + z)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"05285c8b-03bc-400e-ae52-867aa50365c6"},{"version":"CommandV1","origId":2709619314156531,"guid":"273ef936-eaee-4979-8b16-70b710a37d8d","subtype":"command","commandType":"auto","position":17.0,"command":"try:\n    get_code = generate_code_for_casting_columns_based_on_metadata(metadf,table_name,'newdf','casted_df')\n    exec(get_code)\n    print(get_code)\n    logger.info(\"generate_code_for_casting_columns_based_on_metadata function succeeded : refer cmd 16\")\nexcept Exception as e:\n    logger.error(\"generate_code_for_casting_columns_based_on_metadata function FAILED : refer cmd 16 : \" + str(e))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"53ea594a-b0d9-46c3-9c75-7de2f0b6203a"},{"version":"CommandV1","origId":2709619314156532,"guid":"40b10b45-7466-4576-b73c-36ba87874891","subtype":"command","commandType":"auto","position":18.0,"command":"# FUNCTION TO REMOVE DUPLICATE ROWS\n\ndef duplicates_removal(dups_df):\n  df = dups_df.drop_duplicates()\n  keyfields = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\") == 'X').rdd.map(lambda x : x[0]).collect()\n  orderbycol = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Key_Field\").isNull()).rdd.map(lambda x : x[0]).collect()\n\n  windowspec = Window.partitionBy(keyfields).orderBy(orderbycol[0])\n  table_archive = df.withColumn(\"row_number\",row_number().over(windowspec)).select(\"*\").where(col(\"row_number\")==1)\n  table_erroneous = df.withColumn(\"row_number\",row_number().over(windowspec)).select(\"*\").where(col(\"row_number\")>1)\n  return (table_archive,table_erroneous)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"94d78245-b40c-4920-808d-f26f53d5be65"},{"version":"CommandV1","origId":2709619314156533,"guid":"e7f4a2bd-e18d-4fbc-90ad-8e97f1f12ddc","subtype":"command","commandType":"auto","position":19.0,"command":"archive_df,erroneous_df = duplicates_removal(casted_df)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8734b31c-32dc-44c7-baff-7e3a64c34786"},{"version":"CommandV1","origId":2709619314156534,"guid":"a6606f81-d938-4664-8f46-e2c182d95901","subtype":"command","commandType":"auto","position":20.0,"command":"def generate_code_for_adding_flag_columns(metadf,table_name,dfname,newdfname):\n    col1 = metadf.select(\"Field_Name\").where(col(\"Table_Name\")==table_name).where(col(\"Partition_Key\") == 'Y').rdd.map(lambda x : x[0]).collect()\n    if col1:\n        Logic_1 = newdfname + \" = \" + dfname + \".withColumn('partitioncol',lit('ARCHIVE')).withColumn('EPOCH_FLAG',lit('ARCHIVE'))\"\n    else:\n        Logic_1 = newdfname + \" = \" + dfname + \".withColumn('EPOCH_FLAG',lit('ARCHIVE'))\"\n    return(Logic_1)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"76b805e7-012c-4ea5-bc09-62192648f337"},{"version":"CommandV1","origId":2709619314156535,"guid":"d1701fd6-f0c3-494f-a7d2-f70ed1380be1","subtype":"command","commandType":"auto","position":21.0,"command":"# GENERATE SCHEMA FOR ARCHIVE MAIN TABLE\n\ntry:\n    get_code = generate_code_for_adding_flag_columns(metadf,table_name,'archive_df','archive_part_col_added_df')\n    print(get_code)\n    exec(get_code)\n    logger.info(\"Generate Schema for Archive Main Table succeeded : refer cmd 20\")\nexcept Exception as e:\n    logger.error(\"Generate Schema for Archive Main Table FAILED : refer cmd 20 : \" + str(e))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cd03c9dd-2b0d-4107-8e59-18c50cc2fb0d"},{"version":"CommandV1","origId":2709619314156536,"guid":"46cb77df-c644-41e4-9dfa-a65d4c14e0d7","subtype":"command","commandType":"auto","position":22.0,"command":"# GENERATE SCHEMA FOR ERROR TABLE\n\ntry:\n    get_code = generate_code_for_adding_flag_columns(metadf,table_name,'erroneous_df','erroneous_part_col_added_df')\n    print(get_code)\n    exec(get_code)\n    logger.info(\"Generate Schema for Archive Error Table succeeded : refer cmd 21\")\nexcept Exception as e:\n    logger.error(\"Generate Schema for Archive Error Table FAILED : refer cmd 21 : \" + str(e))\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cb8f2bbd-3c8b-437a-a506-cfa30f9eddcc"},{"version":"CommandV1","origId":2709619314156537,"guid":"5d3681f8-d4a7-4879-b571-32a9ba584721","subtype":"command","commandType":"auto","position":23.0,"command":"archive_final_DF = archive_part_col_added_df.withColumn(\"EDA_Creation_date\",current_timestamp())\n# display(archive_final_DF)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"eef49ff5-e6e3-487f-9897-cdff70de591f"},{"version":"CommandV1","origId":2709619314156538,"guid":"06b56c4d-f2dc-4627-8e6a-b291f62e1c23","subtype":"command","commandType":"auto","position":24.0,"command":"erroneous_final_DF = erroneous_part_col_added_df.withColumn(\"EDA_Creation_date\",current_timestamp())\n# display(erroneous_final_DF)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4c1a74ae-f053-4878-be15-eb97de696cfb"},{"version":"CommandV1","origId":2709619314156539,"guid":"4b6a470c-8a9f-48bd-a009-996351054a6b","subtype":"command","commandType":"auto","position":25.0,"command":"archive_write_DF = archive_final_DF.drop(\"row_number\")\nerroneous_write_DF = erroneous_final_DF.drop(\"row_number\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"18f495ac-5c2e-4e84-b15f-9e0664eca14a"},{"version":"CommandV1","origId":2709619314156540,"guid":"45095605-aa7a-433f-8d33-4016b94c6e31","subtype":"command","commandType":"auto","position":26.0,"command":"from delta.tables import *\nfrom pyspark.sql.functions import *","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"174ab3c0-46fe-4754-9bba-e6049123817e"},{"version":"CommandV1","origId":2709619314156543,"guid":"c13513af-04c6-46f4-bdfb-8640c2e4f6b6","subtype":"command","commandType":"auto","position":29.0,"command":"# %sql\n\n# MERGE INTO delta.`abfss://dev@dtecuprodedaadl10.dfs.core.windows.net/curated/ISU_archive/silver_testcopy/FKKMAKT/` AS logs \n# USING newDedupedLogs AS newDedupedLogs \n# ON logs.MANDT = newDedupedLogs.MANDT AND logs.LAUFD = newDedupedLogs.LAUFD AND logs.LAUFI = newDedupedLogs.LAUFI AND logs.GPART = newDedupedLogs.GPART AND logs.VKONT = newDedupedLogs.VKONT AND logs.MAZAE = newDedupedLogs.MAZAE AND logs.AKZAE = newDedupedLogs.AKZAE\n# WHEN MATCHED AND logs.EPOCH_FLAG = 'ARCHIVE' \n# THEN UPDATE SET *\n# WHEN NOT MATCHED \n# THEN INSERT *","commandVersion":22,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5c96702e-2927-40c1-af39-d72f8b9ab646"},{"version":"CommandV1","origId":2709619314156544,"guid":"d7b8043f-ccff-4091-94b6-bb0072e9603b","subtype":"command","commandType":"auto","position":30.0,"command":"print(f\"\"\"\n\n\n\nMERGE INTO delta.`{silver_location[1:-1]}` AS logs\nUSING newDedupedLogs AS newDedupedLogs\nON {cond}\nWHEN MATCHED AND logs.EPOCH_FLAG = 'ARCHIVE'\nTHEN UPDATE SET *\nWHEN NOT MATCHED\nTHEN INSERT *\n\"\"\")","commandVersion":3,"state":"error","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":"<span class=\"ansi-red-fg\">NameError</span>: name &#39;silver_location&#39; is not defined","errorTraceType":"html","error":"<div class=\"ansiout\"><span class=\"ansi-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansi-green-fg\">&lt;command-553411872537840&gt;</span> in <span class=\"ansi-cyan-fg\">&lt;module&gt;</span>\n<span class=\"ansi-green-intense-fg ansi-bold\">      3</span> \n<span class=\"ansi-green-intense-fg ansi-bold\">      4</span> \n<span class=\"ansi-green-fg\">----&gt; 5</span><span class=\"ansi-red-fg\"> </span>MERGE INTO delta<span class=\"ansi-blue-fg\">.</span><span class=\"ansi-red-fg\">`</span><span class=\"ansi-blue-fg\">{</span>silver_location<span class=\"ansi-blue-fg\">[</span><span class=\"ansi-cyan-fg\">1</span><span class=\"ansi-blue-fg\">:</span><span class=\"ansi-blue-fg\">-</span><span class=\"ansi-cyan-fg\">1</span><span class=\"ansi-blue-fg\">]</span><span class=\"ansi-blue-fg\">}</span><span class=\"ansi-red-fg\">`</span> AS logs\n<span class=\"ansi-green-intense-fg ansi-bold\">      6</span> USING newDedupedLogs AS newDedupedLogs\n<span class=\"ansi-green-intense-fg ansi-bold\">      7</span> ON <span class=\"ansi-blue-fg\">{</span>cond<span class=\"ansi-blue-fg\">}</span>\n\n<span class=\"ansi-red-fg\">NameError</span>: name &#39;silver_location&#39; is not defined</div>","workflows":[],"startTime":1663758285535,"submitTime":1663758285535,"finishTime":1663758285732,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6720ea83-c3e7-4fae-9e9d-02101f0f55d4"},{"version":"CommandV1","origId":2709619314156545,"guid":"8f188c03-138b-4462-8574-7c7bc129bfb2","subtype":"command","commandType":"auto","position":31.0,"command":"spark.sql(f\"\"\"\n\n\n\nMERGE INTO delta.`{silver_location[1:-1]}` AS logs\nUSING newDedupedLogs AS newDedupedLogs\nON {cond}\nWHEN MATCHED AND logs.EPOCH_FLAG = 'ARCHIVE'\nTHEN UPDATE SET *\nWHEN NOT MATCHED\nTHEN INSERT *\n\"\"\")","commandVersion":3,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"bda5a7f6-2e85-4b54-b86e-90f1d622b545"}],"dashboards":[],"guid":"954cab5a-eff8-4c73-b614-915f1b0f2606","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"curated_location":{"nuid":"40e2e5ea-20d0-4549-aeb8-cc0afe8beba0","currentValue":"","widgetInfo":{"widgetType":"text","name":"curated_location","defaultValue":"","label":"curated location","options":{"widgetType":"text","validationRegex":null}}},"table_name":{"nuid":"482cde28-0b5c-4356-ae2f-67f32a2f6f96","currentValue":"ERDB","widgetInfo":{"widgetType":"text","name":"table_name","defaultValue":"","label":"table name","options":{"widgetType":"text","validationRegex":null}}},"metafilepath":{"nuid":"5638f1b1-4590-4d1d-80d4-7b7103c79fcb","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/ISU_archive_support/metadata/Final_metadata.csv","widgetInfo":{"widgetType":"text","name":"metafilepath","defaultValue":"","label":"METADATA FILEPATH","options":{"widgetType":"text","validationRegex":null}}},"dbfslogbasepath":{"nuid":"5da80f45-04fe-4fae-aed1-b676751802a2","currentValue":"dbfs:/FileStore/ERDB/","widgetInfo":{"widgetType":"text","name":"dbfslogbasepath","defaultValue":"","label":"DBFS LOG FILE PATH","options":{"widgetType":"text","validationRegex":null}}},"staging_location":{"nuid":"bd3fba4e-3883-4bfa-be9d-9722d94597b6","currentValue":"abfss://dev@dtecuprodedaadl02.dfs.core.windows.net/FileStore/","widgetInfo":{"widgetType":"text","name":"staging_location","defaultValue":"","label":"staging location","options":{"widgetType":"text","validationRegex":null}}},"curated_location_err":{"nuid":"3eaeb54e-a630-4701-a879-a981f6500a31","currentValue":"","widgetInfo":{"widgetType":"text","name":"curated_location_err","defaultValue":"","label":"curated location for error table","options":{"widgetType":"text","validationRegex":null}}},"silver_location":{"nuid":"28e57d4c-513d-49f0-bdd7-53f2f743d062","currentValue":"","widgetInfo":{"widgetType":"text","name":"silver_location","defaultValue":"","label":"silver location","options":{"widgetType":"text","validationRegex":null}}},"FULL_LOAD":{"nuid":"3a4b4075-5406-4186-ab14-55ac68c9ad36","currentValue":"No","widgetInfo":{"widgetType":"text","name":"FULL_LOAD","defaultValue":"No","label":"FULL LOAD","options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}